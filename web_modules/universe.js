var e={find:function(e,n){return e.find(n)},remove:function(e,n){return e.filter((function(r,t){return!!n(r)&&(e.splice(t,1),!0)}))},isArray:n,isObject:r,isBoolean:function(e){return"boolean"==typeof e},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isFunction:t,get:function(e,r){n(r)&&(r=r.join("."));return r.replace("[",".").replace("]","").split(".").reduce((function(e,n){return e[n]}),e)},set:function(e,n,r){"string"==typeof n&&(n=n.replace("[",".").replace("]","").split("."));if(n.length>1){var t=n.shift();Object.assign(e[t]="[object Object]"===Object.prototype.toString.call(e[t])?e[t]:{},n,r)}else e[n[0]]=r},map:function(e,n){var u,i;if(t(n)){if(r(e)){for(i in u=[],e)e.hasOwnProperty(i)&&u.push(n(e[i],i,e));return u}return e.map(n)}if(r(e)){for(i in u=[],e)e.hasOwnProperty(i)&&u.push(e[i]);return u}return e.map((function(e){return e[n]}))},keys:function(e){return Object.keys(e)},sortBy:function(e,n){if(t(n))return e.sort((function(e,r){return n(e)>n(r)?1:n(e)<n(r)?-1:0}))},forEach:u,isUndefined:function(e){return void 0===e},pick:function(e,n){var r={};return u(n,(function(n){void 0!==e[n]&&(r[n]=e[n])})),r},xor:function(e,n){var r=[];return u(e,(function(e){if(-1===n.indexOf(e))return r.push(e)})),u(n,(function(n){if(-1===e.indexOf(n))return r.push(n)})),r},clone:i,isEqual:function e(n,r){if("object"==typeof n&&null!==n&&"object"==typeof r&&null!==r){if(Object.keys(n).length!==Object.keys(r).length)return!1;for(var t in n)return r.hasOwnProperty(t)&&e(n[t],r[t]),!1;return!0}if(n!==r)return!1;return!0},replaceArray:function(e,n){var r=e.length,t=n.length;r>t?e.splice(t,r-t):r<t&&e.push.apply(e,new Array(t-r));return u(e,(function(r,t){e[t]=n[t]})),e},uniq:function(e){var n=new Set;return e.filter((function(e){var r=!1;return n.has(e)||(n.add(e),r=!0),r}))},flatten:function(e){for(var n=[],r=0;r<e.length;++r)for(var t=e[r],u=0;u<t.length;++u)n.push(t[u]);return n},sort:function(e){for(var n=1;n<e.length;n++){for(var r=e[n],t=n;e[t-1]>r;)e[t]=e[t-1],--t;e[t]=r}return e},values:function(e){var n=[];for(var r in e)e.hasOwnProperty(r)&&n.push(e[r]);return n},recurseObject:function(e,n){return function e(r,t){for(var u in r){var o=i(t);if(o.push(u),"object"==typeof r[u]&&null!==r[u])e(r[u],o);else{if(!r.hasOwnProperty(u))continue;n(r[u],u,o)}}}(e,[]),e}};function n(e){return Array.isArray(e)}function r(e){return"object"==typeof e&&!n(e)}function t(e){return"function"==typeof e}function u(e,t){if(r(e))for(var u in e)e.hasOwnProperty(u)&&t(e[u],u,e);else if(n(e))return e.forEach(t)}function i(e){return JSON.parse(JSON.stringify(e,(function(e,n){return"function"==typeof n?n.toString():n})))}var o={$field:function(e,n){return e[n]},$and:function(e,n){n=n(e);for(var r=0;r<n.length;r++)if(!n[r])return!1;return!0},$or:function(e,n){n=n(e);for(var r=0;r<n.length;r++)if(n[r])return!0;return!1},$not:function(e,n){n=n(e);for(var r=0;r<n.length;r++)if(n[r])return!1;return!0},$eq:function(e,n){return e===n()},$gt:function(e,n){return e>n()},$gte:function(e,n){return e>=n()},$lt:function(e,n){return e<n()},$lte:function(e,n){return e<=n()},$ne:function(e,n){return e!==n()},$type:function(e,n){return typeof e===n()},$in:function(e,n){return e.indexOf(n())>-1},$nin:function(e,n){return-1===e.indexOf(n())},$contains:function(e,n){return n().indexOf(e)>-1},$excludes:function(e,n){return-1===n().indexOf(e)},$size:function(e,n){return e.length===n()}};var a={$sum:function(e){return e.reduce((function(e,n){return e+n}),0)},$avg:function(e){return e.reduce((function(e,n){return e+n}),0)/e.length},$max:function(e){return Math.max.apply(null,e)},$min:function(e){return Math.min.apply(null,e)},$count:function(e){return e.length},$first:function(e){return e[0]},$last:function(e){return e[e.length-1]},$get:h,$nth:h,$nthLast:function(e,n){return e[e.length-n]},$nthPct:function(e,n){return e[Math.round(e.length*(n/100))]},$map:function(e,n){return e.map((function(e){return e[n]}))}},c={makeValueAccessor:function(n){if("string"==typeof n){if(!l(n))return n;n=v(n)}if("number"==typeof n)return n;if(e.isObject(n))return r=f(n),function(e){return r(e)};var r},aggregators:a,extractKeyValOrArray:s,parseAggregatorParams:function(e){var n=[],r=e.indexOf("("),t=e.indexOf(")"),u=r>-1?e.substring(0,r):e;if(!a[u])return!1;r>-1&&t>-1&&t>r&&(n=e.substring(r+1,t).split(","));return{aggregator:a[u],params:n}}};function f(n){if(n=e.isObject(n)?s(n):n,e.isString(n))return l(n)?f(v(n)):function(e){return e[n]};if(e.isArray(n)){var r=e.map(n,f);return function(e){return r.map((function(n){return n(e)}))}}if(n.key){if(a[n.key]){var t=f(n.value);return function(e){return a[n.key](t(e))}}console.error("Could not find aggregration method",n)}return[]}function s(e){var n,r=[];for(var t in e)if({}.hasOwnProperty.call(e,t)){n={key:t,value:e[t]};var u={};u[t]=e[t],r.push(u)}return r.length>1?r:n}function l(e){return["$","("].indexOf(e.charAt(0))>-1}function v(e){var n=/\((.+)\)/g,r=/(?:\([^\(\)]*\))|(,)/g;return JSON.parse("{"+function e(t){return'"'+(t=t.replace(" ","")).replace(n,(function(n,t){if(r.test(t))return"$"===t.charAt(0)?'":{"'+t.replace(r,(function(n){return","===n?',"':e(n).trim()}))+"}":':["'+t.replace(r,(function(){return'","'}))+'"]'}))}(e)+"}")}function h(e,n){return e[n]}function d(n){return{filter:function(e,i,o,a){return r(e).then((function(e){var r=Object.assign({},n.filters),c=e.key;return"array"===e.complex&&(c=JSON.stringify(e.key)),"function"===e.complex&&(c=e.key.toString()),r[c]=t(i,o,a),u(r)}))},filterAll:function(i){if(!i)return n.columns.forEach((function(e){e.dimension.filterAll()})),u({});var o=Object.assign({},n.filters),a=e.map(i,(function(e){return r(e.column).then((function(n){var r=n.complex?JSON.stringify(n.key):n.key;o[r]=t(e.value,e.isRange,e.replace)}))}));return Promise.all(a).then((function(){return u(o)}))},applyFilters:u,makeFunction:a,scanForDynamicFilters:function(n){var r=[];return function n(t){e.forEach(t,(function(t,u){var o=i(t,u);o&&r.push(o),e.isString(t)&&(o=i(null,t))&&r.push(o),e.isObject(t)&&n(t)}))}(n.filter),r}};function r(e){var r=n.column.find(e);return new Promise((function(t,u){try{if(!r)return t(n.column({key:e,temporary:!0}).then((function(){return n.column.find(e)})));t(r)}catch(e){u(e)}}))}function t(n,r,t){return!e.isUndefined(n)&&(e.isFunction(n)?{value:n,function:n,replace:!0,type:"function"}:e.isObject(n)?{value:n,function:a(n),replace:!0,type:"function"}:e.isArray(n)?{value:n,replace:r||t,type:r?"range":"inclusive"}:{value:n,replace:t,type:"exact"})}function u(r){var t=e.map(r,(function(t,u){var i,o=n.filters[u];return t===o?Promise.resolve():(i="["===u.charAt(0)?n.column.find(JSON.parse(u)):n.column.find(u),t&&o&&!t.replace&&(r[u]=t=function(n,r){if("exact"===n.type&&"inclusive"===r.type)n.value=e.xor([n.value],r.value);else if("inclusive"===n.type&&"exact"===r.type)n.value=e.xor(n.value,[r.value]);else if("inclusive"===n.type&&"inclusive"===r.type)n.value=e.xor(n.value,r.value);else if("exact"===n.type&&"exact"===r.type){if(n.value===r.value)return!1;n.value=[n.value,r.value]}n.value.length?1===n.value.length?(n.type="exact",n.value=n.value[0]):n.type="inclusive":n=!1;return n}(t,o)),t?"exact"===t.type?Promise.resolve(i.dimension.filterExact(t.value)):"range"===t.type?Promise.resolve(i.dimension.filterRange(t.value)):"inclusive"===t.type?Promise.resolve(i.dimension.filterFunction((function(e){return t.value.indexOf(e)>-1}))):"function"===t.type?Promise.resolve(i.dimension.filterFunction(t.function)):Promise.resolve(i.dimension.filterAll()):Promise.resolve(i.dimension.filterAll()))}));return Promise.all(t).then((function(){n.filters=r;var t=[];return e.forEach(n.filters,(function(e,r){e||(t.push({key:r,val:e}),delete n.filters[r])})),Promise.all(e.map(t,(function(e){var r=n.column.find("["===e.key.charAt(0)?JSON.parse(e.key):e.key);if(r.temporary&&!r.dynamicReference)return n.clear(r.key)})))})).then((function(){return Promise.all(e.map(n.filterListeners,(function(e){return e()})))})).then((function(){return n}))}function i(n,r){return"$data"===r||(r&&"$column"===r?e.isString(n)?n:(console.warn('The value for filter "$column" must be a valid column key',n),!1):void 0)}function a(r,t){var u;if(e.isString(r)&&i(null,r)){var f=n.cf.all();return function(){return f}}return e.isString(r)||e.isNumber(r)||e.isBoolean(r)?function(e){return void 0===e?r:o.$eq(e,(function(){return r}))}:e.isArray(r)?(u=e.map(r,(function(e){return a(e,t)})),function(e){return u.map((function(n){return n(e)}))}):e.isObject(r)?(u=e.map(r,(function(e,r){var u=a(e,t),f=i(e,r);if(f){var s=n.column.find(f).values;return function(){return s}}if(o[r])return function(e){return o[r](e,u)};var l=c.parseAggregatorParams(r);return l?(u=a(e,t=!0),function(){return l.aggregator.apply(null,[u()].concat(l.params))}):function(e){return e=e[r],u(e,u)}})),t?1===u.length?function(e){return u[0](e)}:function(n){return e.map(u,(function(e){return e(n)}))}:function(n){return o.$and(n,(function(n){return e.map(u,(function(e){return e(n)}))}))}):(console.log("no expression found for ",r),!1)}}let p=b,g=b,m=b,y=A,x=k;function b(e){for(var n=new Array(e),r=-1;++r<e;)n[r]=0;return n}function A(e,n){for(var r=e.length;r<n;)e[r++]=0;return e}function k(e,n){if(n>32)throw new Error("invalid array width!");return e}function O(e){this.length=e,this.subarrays=1,this.width=8,this.masks={0:0},this[0]=p(e)}"undefined"!=typeof Uint8Array&&(p=function(e){return new Uint8Array(e)},g=function(e){return new Uint16Array(e)},m=function(e){return new Uint32Array(e)},y=function(e,n){if(e.length>=n)return e;var r=new e.constructor(n);return r.set(e),r},x=function(e,n){var r;switch(n){case 16:r=g(e.length);break;case 32:r=m(e.length);break;default:throw new Error("invalid array width!")}return r.set(e),r}),O.prototype.lengthen=function(e){var n,r;for(n=0,r=this.subarrays;n<r;++n)this[n]=y(this[n],e);this.length=e},O.prototype.add=function(){var e,n,r,t,u;for(t=0,u=this.subarrays;t<u;++t)if(r=(~(e=this.masks[t])&e+1)>>>0,!((n=this.width-32*t)>=32)||r)return n<32&&r&1<<n&&(this[t]=x(this[t],n<<=1),this.width=32*t+n),this.masks[t]|=r,{offset:t,one:r};return this[this.subarrays]=p(this.length),this.masks[this.subarrays]=1,this.width+=8,{offset:this.subarrays++,one:1}},O.prototype.copy=function(e,n){var r,t;for(r=0,t=this.subarrays;r<t;++r)this[r][e]=this[r][n]},O.prototype.truncate=function(e){var n,r;for(n=0,r=this.subarrays;n<r;++n)for(var t=this.length-1;t>=e;t--)this[n][t]=0;this.length=e},O.prototype.zero=function(e){var n,r;for(n=0,r=this.subarrays;n<r;++n)if(this[n][e])return!1;return!0},O.prototype.zeroExcept=function(e,n,r){var t,u;for(t=0,u=this.subarrays;t<u;++t)if(t===n?this[t][e]&r:this[t][e])return!1;return!0},O.prototype.zeroExceptMask=function(e,n){var r,t;for(r=0,t=this.subarrays;r<t;++r)if(this[r][e]&n[r])return!1;return!0},O.prototype.only=function(e,n,r){var t,u;for(t=0,u=this.subarrays;t<u;++t)if(this[t][e]!=(t===n?r:0))return!1;return!0},O.prototype.onlyExcept=function(e,n,r,t,u){var i,o,a;for(o=0,a=this.subarrays;o<a;++o)if(i=this[o][e],o===n&&(i&=r),i!=(o===t?u:0))return!1;return!0};var L={array8:b,array16:b,array32:b,arrayLengthen:A,arrayWiden:k,bitarray:O};var w=(e,n)=>function(r){var t=r.length;return[e.left(r,n,0,t),e.right(r,n,0,t)]},E=(e,n)=>{var r=n[0],t=n[1];return function(n){var u=n.length;return[e.left(n,r,0,u),e.left(n,t,0,u)]}},S=e=>[0,e.length],P=e=>e,$=()=>null,R=()=>0;function z(e){function n(e,n,t){for(var u=t-n,i=1+(u>>>1);--i>0;)r(e,i,u,n);return e}function r(n,r,t,u){for(var i,o=n[--u+r],a=e(o);(i=r<<1)<=t&&(i<t&&e(n[u+i])>e(n[u+i+1])&&i++,!(a<=e(n[u+i])));)n[u+r]=n[u+i],r=i;n[u+r]=o}return n.sort=function(e,n,t){for(var u,i=t-n;--i>0;)u=e[n],e[n]=e[n+i],e[n+i]=u,r(e,1,i,n);return e},n}const I=z(P);function j(e){var n=I.by(e);return function(r,t,u,i){var o,a,c,f=new Array(i=Math.min(u-t,i));for(a=0;a<i;++a)f[a]=r[t++];if(n(f,0,i),t<u){o=e(f[0]);do{e(c=r[t])>o&&(f[0]=c,o=e(n(f,0,i)[0]))}while(++t<u)}return f}}I.by=z;const q=j(P);function C(e){function n(n,r,t,u){for(;t<u;){var i=t+u>>>1;r<e(n[i])?u=i:t=i+1}return t}return n.right=n,n.left=function(n,r,t,u){for(;t<u;){var i=t+u>>>1;e(n[i])<r?t=i+1:u=i}return t},n}q.by=j;const M=C(P);M.by=C;var F=(e,n,r)=>{for(var t=0,u=n.length,i=r?JSON.parse(JSON.stringify(e)):new Array(u);t<u;++t)i[t]=e[n[t]];return i};var N=e=>e+1,K=e=>e-1,U=e=>function(n,r){return n+ +e(r)},B=e=>function(n,r){return n-e(r)};function V(e,n,r,t,u){for(u in t=(r=r.split(".")).splice(-1,1),r)n=n[r[u]]=n[r[u]]||{};return e(n,t)}const J=(e,n)=>{const r=e[n];return"function"==typeof r?r.call(e):r},T=/\[([\w\d]+)\]/g;var W=(e,n)=>V(J,e,n.replace(T,".$1"));function D(){var e,n={add:c,remove:f,dimension:v,groupAll:h,size:d,all:p,allFiltered:g,onChange:m,isElementFiltered:l},r=[],t=0,u=[],i=[],o=[],a=[];function c(u){var o=t,a=u.length;return a&&(r=r.concat(u),e.lengthen(t+=a),i.forEach((function(e){e(u,o,a)})),y("dataAdded")),n}function f(n){for(var i,a=new Array(t),c=[],f="function"==typeof n,s=0,l=0;s<t;++s)i=s,(f?n(r[i],i):e.zero(i))?(c.push(s),a[s]=-1):a[s]=l++;u.forEach((function(e){e(-1,-1,[],c,!0)})),o.forEach((function(e){e(a)}));for(var v=0,h=0;v<t;++v)-1!==a[v]&&(v!==h&&(e.copy(h,v),r[h]=r[v]),++h);r.length=t=h,e.truncate(h),y("dataRemoved")}function s(n){var r,t,u,i,o=Array(e.subarrays);for(r=0;r<e.subarrays;r++)o[r]=-1;for(t=0,u=n.length;t<u;t++)o[(i=n[t].id())>>7]&=~(1<<(63&i));return o}function l(n,r){var t=s(r||[]);return e.zeroExceptMask(n,t)}function v(n,a){if("string"==typeof n){var c=n;n=function(e){return W(e,c)}}var f,s,l,v,h,d,p,g,m,x,b,A,k,O,z={filter:function(e){return null==e?ie():Array.isArray(e)?ue(e):"function"==typeof e?oe(e):te(e)},filterExact:te,filterRange:ue,filterFunction:oe,filterAll:ie,currentFilter:function(){return A},hasCurrentFilter:function(){return k},top:function(n,t){var u,i=[],o=H,c=0;t&&t>0&&(c=t);for(;--o>=D&&n>0;)e.zero(u=d[o])&&(c>0?--c:(i.push(r[u]),--n));if(a)for(o=0;o<j.length&&n>0;o++)e.zero(u=j[o])&&(c>0?--c:(i.push(r[u]),--n));return i},bottom:function(n,t){var u,i,o=[],c=0;t&&t>0&&(c=t);if(a)for(u=0;u<j.length&&n>0;u++)e.zero(i=j[u])&&(c>0?--c:(o.push(r[i]),--n));u=D;for(;u<H&&n>0;)e.zero(i=d[u])&&(c>0?--c:(o.push(r[i]),--n)),u++;return o},group:ce,groupAll:function(){var e=ce($),n=e.all;return delete e.all,delete e.top,delete e.order,delete e.orderNatural,delete e.size,e.value=function(){return n()[0].value},e},dispose:fe,remove:fe,accessor:n,id:function(){return v}},j=[],C=function(e){return G(e).sort((function(e,n){var r=p[e],t=p[n];return r<t?-1:r>t?1:e-n}))},V=S,J=[],T=[],D=0,H=0,Q=0;i.unshift(_),i.push(ee),o.push(ne);var Z=e.add();function _(r,u,i){var o,c;if(a){Q=0,U=0,O=[];for(var s=0;s<r.length;s++)for(U=0,O=n(r[s]);U<O.length;U++)Q++;p=[],o=G(r.length),c=Y(Q,1);for(var v=G(Q),y=0,A=0;A<r.length;A++)if((O=n(r[A])).length)for(o[A]=O.length,U=0;U<O.length;U++)p.push(O[U]),v[y]=A,y++;else o[A]=0,j.push(A+u);var k=C(Q);p=F(p,k),g=F(v,k)}else p=r.map(n),g=C(i),p=F(p,g);var w,E,S,P=V(p),$=P[0],R=P[1];if(a)if(i=Q,b)for(w=0;w<i;++w)b(p[w],w)||(0==--o[g[w]]&&(e[l][g[w]+u]|=f),c[w]=1);else{for(E=0;E<$;++E)0==--o[g[E]]&&(e[l][g[E]+u]|=f),c[E]=1;for(S=R;S<i;++S)0==--o[g[S]]&&(e[l][g[S]+u]|=f),c[S]=1}else if(b)for(w=0;w<i;++w)b(p[w],w)||(e[l][g[w]+u]|=f);else{for(E=0;E<$;++E)e[l][g[E]+u]|=f;for(S=R;S<i;++S)e[l][g[S]+u]|=f}if(!u)return h=p,d=g,m=o,x=c,D=$,void(H=R);var z,I=h,q=d,M=x,N=0;if(s=0,a&&(z=u,u=I.length,i=Q),h=new Array(a?u+i:t),d=a?new Array(u+i):Y(t,t),a&&(x=Y(u+i,1)),a){var K=m.length;m=L.arrayLengthen(m,t);for(var U=0;U+K<t;U++)m[U+K]=o[U]}for(var B=0;s<u&&N<i;++B)I[s]<p[N]?(h[B]=I[s],a&&(x[B]=M[s]),d[B]=q[s++]):(h[B]=p[N],a&&(x[B]=c[N]),d[B]=g[N++]+(a?z:u));for(;s<u;++s,++B)h[B]=I[s],a&&(x[B]=M[s]),d[B]=q[s];for(;N<i;++N,++B)h[B]=p[N],a&&(x[B]=c[N]),d[B]=g[N]+(a?z:u);P=V(h),D=P[0],H=P[1]}function ee(e,n,r){J.forEach((function(e){e(p,g,n,r)})),p=g=null}function ne(e){if(a){for(var n=0,r=0;n<j.length;n++)-1!==e[j[n]]&&(j[r]=e[j[n]],r++);for(j.length=r,n=0,r=0;n<t;n++)-1!==e[n]&&(r!==n&&(m[r]=m[n]),r++);m=m.slice(0,r)}for(var u,i=h.length,o=0,c=0;o<i;++o)-1!==e[u=d[o]]&&(o!==c&&(h[c]=h[o]),d[c]=e[u],a&&(x[c]=x[o]),++c);for(h.length=c,a&&(x=x.slice(0,c));c<i;)d[c++]=0;var f=V(h);D=f[0],H=f[1]}function re(n){var r=n[0],t=n[1];if(b)return b=null,ae((function(e,n){return r<=n&&n<t}),0===n[0]&&n[1]===h.length),D=r,H=t,z;var i,o,c,s=[],v=[],p=[],g=[];if(r<D)for(i=r,o=Math.min(D,t);i<o;++i)s.push(d[i]),p.push(i);else if(r>D)for(i=D,o=Math.min(r,H);i<o;++i)v.push(d[i]),g.push(i);if(t>H)for(i=Math.max(r,H),o=t;i<o;++i)s.push(d[i]),p.push(i);else if(t<H)for(i=Math.max(D,t),o=H;i<o;++i)v.push(d[i]),g.push(i);if(a){var A=[],k=[];for(i=0;i<s.length;i++)m[s[i]]++,x[p[i]]=0,1===m[s[i]]&&(e[l][s[i]]^=f,A.push(s[i]));for(i=0;i<v.length;i++)m[v[i]]--,x[g[i]]=1,0===m[v[i]]&&(e[l][v[i]]^=f,k.push(v[i]));if(s=A,v=k,V===S)for(i=0;i<j.length;i++)e[l][c=j[i]]&f&&(e[l][c]^=f,s.push(c));else for(i=0;i<j.length;i++)e[l][c=j[i]]&f||(e[l][c]^=f,v.push(c))}else{for(i=0;i<s.length;i++)e[l][s[i]]^=f;for(i=0;i<v.length;i++)e[l][v[i]]^=f}return D=r,H=t,u.forEach((function(e){e(f,l,s,v)})),y("filtered"),z}function te(e){return A=e,k=!0,re((V=w(M,e))(h))}function ue(e){return A=e,k=!0,re((V=E(M,e))(h))}function ie(){return A=void 0,k=!1,re((V=S)(h))}function oe(e){A=e,k=!0,b=e,V=S,ae(e,!1);var n=V(h);return D=n[0],H=n[1],z}function ae(n,r){var t,i,o,c=[],v=[],p=[],g=[],b=h.length;if(!a)for(t=0;t<b;++t)!(e[l][i=d[t]]&f)^!!(o=n(h[t],t))&&(o?c.push(i):v.push(i));if(a)for(t=0;t<b;++t)n(h[t],t)?(c.push(d[t]),p.push(t)):(v.push(d[t]),g.push(t));if(a){var A=[],k=[];for(t=0;t<c.length;t++)1===x[p[t]]&&(m[c[t]]++,x[p[t]]=0,1===m[c[t]]&&(e[l][c[t]]^=f,A.push(c[t])));for(t=0;t<v.length;t++)0===x[g[t]]&&(m[v[t]]--,x[g[t]]=1,0===m[v[t]]&&(e[l][v[t]]^=f,k.push(v[t])));if(c=A,v=k,r)for(t=0;t<j.length;t++)e[l][i=j[t]]&f&&(e[l][i]^=f,c.push(i));else for(t=0;t<j.length;t++)e[l][i=j[t]]&f||(e[l][i]^=f,v.push(i))}else{for(t=0;t<c.length;t++)e[l][c[t]]&f&&(e[l][c[t]]&=s);for(t=0;t<v.length;t++)e[l][v[t]]&f||(e[l][v[t]]|=f)}u.forEach((function(e){e(f,l,c,v)})),y("filtered")}function ce(n){var i={top:G,all:D,reduce:H,reduceCount:Q,reduceSum:Z,order:_,orderNatural:ee,size:ne,dispose:re,remove:re};T.push(i);var c,v,p,g,m,y,x,b,A=8,k=X(A),O=0,w=$,E=$,S=!0,z=n===$;function j(i,o,f,d){a&&(b=f,f=h.length-i.length,d=i.length);var p,g,P,R,I,j,q=c,C=a?[]:Y(O,k),N=m,K=y,U=x,B=O,J=0,T=0;for(S&&(N=U=$),S&&(K=U=$),c=new Array(O),O=0,v=a?B?v:[]:B>1?L.arrayLengthen(v,t):Y(t,k),B&&(P=(g=q[0]).key);T<d&&!((R=n(i[T]))>=R);)++T;for(;T<d;){for(g&&P<=R?(I=g,j=P,C[J]=O,(g=q[++J])&&(P=g.key)):(I={key:R,value:U()},j=R),c[O]=I;R<=j&&(p=o[T]+(a?b:f),a?v[p]?v[p].push(O):v[p]=[O]:v[p]=O,I.value=N(I.value,r[p],!0),e.zeroExcept(p,l,s)||(I.value=K(I.value,r[p],!1)),!(++T>=d));)R=n(i[T]);G()}for(;J<B;)c[C[J]=O]=q[J++],G();if(a)for(var D=0;D<t;D++)v[D]||(v[D]=[]);if(O>J)if(a)for(J=0;J<b;++J)for(D=0;D<v[J].length;D++)v[J][D]=C[v[J][D]];else for(J=0;J<f;++J)v[J]=C[v[J]];function G(){a?O++:++O===k&&(C=L.arrayWiden(C,A<<=1),v=L.arrayWiden(v,A),k=X(A))}p=u.indexOf(w),O>1||a?(w=M,E=V):(!O&&z&&(O=1,c=[{key:null,value:U()}]),1===O?(w=F,E=W):(w=$,E=$),v=null),u[p]=w}function C(e){if(O>1||a){var n,r,i,o=O,f=c,s=Y(o,o);if(a){for(n=0,i=0;n<t;++n)if(-1!==e[n]){for(v[i]=v[n],r=0;r<v[i].length;r++)s[v[i][r]]=1;++i}}else for(n=0,i=0;n<t;++n)-1!==e[n]&&(s[v[i]=v[n]]=1,++i);for(c=[],O=0,n=0;n<o;++n)s[n]&&(s[n]=O++,c.push(f[n]));if(O>1||a)if(a)for(n=0;n<i;++n)for(r=0;r<v[n].length;++r)v[n][r]=s[v[n][r]];else for(n=0;n<i;++n)v[n]=s[v[n]];else v=null;u[u.indexOf(w)]=O>1||a?(E=V,w=M):1===O?(E=W,w=F):E=w=$}else if(1===O){if(z)return;for(var l=0;l<t;++l)if(-1!==e[l])return;c=[],O=0,u[u.indexOf(w)]=w=E=$}}function M(n,t,u,i,o){var h,d,p,g,x;if(!(n===f&&t===l||S))if(a){for(h=0,g=u.length;h<g;++h)if(e.zeroExcept(p=u[h],l,s))for(d=0;d<v[p].length;d++)(x=c[v[p][d]]).value=m(x.value,r[p],!1,d);for(h=0,g=i.length;h<g;++h)if(e.onlyExcept(p=i[h],l,s,t,n))for(d=0;d<v[p].length;d++)(x=c[v[p][d]]).value=y(x.value,r[p],o,d)}else{for(h=0,g=u.length;h<g;++h)e.zeroExcept(p=u[h],l,s)&&((x=c[v[p]]).value=m(x.value,r[p],!1));for(h=0,g=i.length;h<g;++h)e.onlyExcept(p=i[h],l,s,t,n)&&((x=c[v[p]]).value=y(x.value,r[p],o))}}function F(n,t,u,i,o){if(!(n===f&&t===l||S)){var a,v,h,d=c[0];for(a=0,h=u.length;a<h;++a)e.zeroExcept(v=u[a],l,s)&&(d.value=m(d.value,r[v],!1));for(a=0,h=i.length;a<h;++a)e.onlyExcept(v=i[a],l,s,t,n)&&(d.value=y(d.value,r[v],o))}}function V(){var n,u,i;for(n=0;n<O;++n)c[n].value=x();if(a){for(n=0;n<t;++n)for(u=0;u<v[n].length;u++)(i=c[v[n][u]]).value=m(i.value,r[n],!0,u);for(n=0;n<t;++n)if(!e.zeroExcept(n,l,s))for(u=0;u<v[n].length;u++)(i=c[v[n][u]]).value=y(i.value,r[n],!1,u)}else{for(n=0;n<t;++n)(i=c[v[n]]).value=m(i.value,r[n],!0);for(n=0;n<t;++n)e.zeroExcept(n,l,s)||((i=c[v[n]]).value=y(i.value,r[n],!1))}}function W(){var n,u=c[0];for(u.value=x(),n=0;n<t;++n)u.value=m(u.value,r[n],!0);for(n=0;n<t;++n)e.zeroExcept(n,l,s)||(u.value=y(u.value,r[n],!1))}function D(){return S&&(E(),S=!1),c}function G(e){var n=p(D(),0,c.length,e);return g.sort(n,0,n.length)}function H(e,n,r){return m=e,y=n,x=r,S=!0,i}function Q(){return H(N,K,R)}function Z(e){return H(U(e),B(e),R)}function _(e){function n(n){return e(n.value)}return p=q.by(n),g=I.by(n),i}function ee(){return _(P)}function ne(){return O}function re(){var e=u.indexOf(w);return e>=0&&u.splice(e,1),(e=J.indexOf(j))>=0&&J.splice(e,1),(e=o.indexOf(C))>=0&&o.splice(e,1),(e=T.indexOf(i))>=0&&T.splice(e,1),i}return arguments.length<1&&(n=P),u.push(w),J.push(j),o.push(C),j(h,d,0,t),Q().orderNatural()}function fe(){T.forEach((function(e){e.dispose()}));var n=i.indexOf(_);return n>=0&&i.splice(n,1),(n=i.indexOf(ee))>=0&&i.splice(n,1),(n=o.indexOf(ne))>=0&&o.splice(n,1),e.masks[l]&=s,ie()}return l=Z.offset,f=Z.one,s=~f,v=l<<7|Math.log(f)/Math.log(2),_(r,0,t),ee(r,0,t),z}function h(){var n,o,a,c,f={reduce:h,reduceCount:d,reduceSum:function(e){return h(U(e),B(e),R)},value:function(){s&&(function(){var u;for(n=c(),u=0;u<t;++u)n=o(n,r[u],!0),e.zero(u)||(n=a(n,r[u],!1))}(),s=!1);return n},dispose:p,remove:p},s=!0;function l(u,i){var c;if(!s)for(c=i;c<t;++c)n=o(n,r[c],!0),e.zero(c)||(n=a(n,r[c],!1))}function v(t,u,i,c,f){var l,v,h;if(!s){for(l=0,h=i.length;l<h;++l)e.zero(v=i[l])&&(n=o(n,r[v],f));for(l=0,h=c.length;l<h;++l)e.only(v=c[l],u,t)&&(n=a(n,r[v],f))}}function h(e,n,r){return o=e,a=n,c=r,s=!0,f}function d(){return h(N,K,R)}function p(){var e=u.indexOf(v);return e>=0&&u.splice(e,1),(e=i.indexOf(l))>=0&&i.splice(e,1),f}return u.push(v),i.push(l),l(r,0),d()}function d(){return t}function p(){return r}function g(n){var u=[],i=0,o=s(n||[]);for(i=0;i<t;i++)e.zeroExceptMask(i,o)&&u.push(r[i]);return u}function m(e){if("function"==typeof e)return a.push(e),function(){a.splice(a.indexOf(e),1)};console.warn("onChange callback parameter must be a function!")}function y(e){for(var n=0;n<a.length;n++)a[n](e)}return e=new L.bitarray(0),arguments.length?c(arguments[0]):n}function Y(e,n){return(n<257?L.array8:n<65537?L.array16:L.array32)(e)}function G(e){for(var n=Y(e,e),r=-1;++r<e;)n[r]=r;return n}function X(e){return 8===e?256:16===e?65536:4294967296}function H(n){var r=function(n){return{make:function(e,t,u){var i=r(e,u);return Promise.resolve(n.cf.dimension(i,"array"===t))},makeAccessor:r};function r(n,r){var t;if("string"===r)t=function(r){return e.get(r,n)};else if("function"===r)t=n;else if("array"===r){var u=e.map(n,(function(e){return"d['"+e+"']"}));t=new Function("d",String("return "+JSON.stringify(u).replace(/"/g,"")))}else t=!0===n?function(e,n){return n}:function(e){return e[n]};return t}}(n),t=function(r){e.isUndefined(r)&&(r=!0);e.isArray(r)||(r=[r]);return Promise.all(e.map(r,i)).then((function(){return n}))};return t.find=u,t;function u(r){return e.find(n.columns,(function(n){return e.isArray(r)?!e.xor(n.key,r).length:n.key===r}))}function i(t){var i=e.isObject(t)?t:{key:t},o=u(i.key);return o?(o.temporary=!1,o.dynamicReference&&(o.dynamicReference=!1),o.promise.then((function(){return n}))):(i.queries=[],n.columns.push(i),i.promise=new Promise((function(e,r){try{e(n.cf.all())}catch(e){r(e)}})).then((function(n){var t;if(e.isFunction(i.key))i.complex="function",t=i.key(n[0]);else if(e.isString(i.key)&&(i.key.indexOf(".")>-1||i.key.indexOf("[")>-1))i.complex="string",t=e.get(n[0],i.key);else if(e.isArray(i.key)){if(i.complex="array",(t=e.values(e.pick(n[0],i.key))).length!==i.key.length)throw new Error("Column key does not exist in data!",i.key)}else t=n[0][i.key];if(!i.complex&&!0!==i.key&&void 0===t)throw new Error("Column key does not exist in data!",i.key);return!0===i.key?i.type="all":i.complex?i.type="complex":i.array?i.type="array":i.type=function(n){return e.isNumber(n)?"number":e.isBoolean(n)?"bool":e.isArray(n)?"array":e.isObject(n)?"object":"string"}(t),r.make(i.key,i.type,i.complex)})).then((function(t){i.dimension=t,i.filterCount=0;var u=n.onDataChange(o);return i.removeListeners=[u],o();function o(n){if(!0===i.key)return Promise.resolve();var t=r.makeAccessor(i.key,i.complex);return i.values=i.values||[],new Promise((function(e,r){try{n&&n.added?e(n.added):e(i.dimension.bottom(1/0))}catch(e){r(e)}})).then((function(n){var r;r="string"===i.complex||"function"===i.complex?e.map(n,t):"array"===i.type?e.flatten(e.map(n,t)):e.map(n,t),i.values=e.uniq(i.values.concat(r))}))}})),i.promise.then((function(){return n})))}}D.heap=I,D.heapselect=q,D.bisect=M,D.permute=F;var Q=function(e,n,r){return function(t,u,i){return e(u,i)?n&&n(t,u,i):r&&r(t,u,i),t}},Z=function(e,n,r){return function(t,u,i){return e(u,i)?n&&n(t,u,i):r&&r(t,u,i),t}},_=function(e,n,r){return function(t,u,i){return e&&e(t,u,i),n(t)[r]++,t}},ee=function(e,n,r){return function(t,u,i){return e&&e(t,u,i),n(t)[r]--,t}},ne=function(e,n,r){return function(t){return e&&(t=e(t)),n(t)[r]=0,t}},re=function(e,n,r){return function(t,u,i){return n&&n(t,u,i),r(t).sum=r(t).sum+e(u),t}},te=function(e,n,r){return function(t,u,i){return n&&n(t,u,i),r(t).sum=r(t).sum-e(u),t}},ue=function(e,n){return function(r){return r=e(r),n(r).sum=0,r}},ie=function(e,n,r){return function(e,t,u){return n&&n(e,t,u),r(e).count>0?r(e).avg=r(e).sum/r(e).count:r(e).avg=0,e}},oe=function(e,n,r){return function(e,t,u){return n&&n(e,t,u),r(e).count>0?r(e).avg=r(e).sum/r(e).count:r(e).avg=0,e}},ae=function(e,n){return function(r){return r=e(r),n(r).avg=0,r}},ce=function(e,n){var r;return function(t,u,i){return e&&e(t,u,i),r=Math.floor(n(t).valueList.length/2),n(t).valueList.length%2?n(t).median=n(t).valueList[r]:n(t).median=(n(t).valueList[r-1]+n(t).valueList[r])/2,t}},fe=function(e,n){var r;return function(t,u,i){return e&&e(t,u,i),r=Math.floor(n(t).valueList.length/2),0===n(t).valueList.length?(n(t).median=void 0,t):(1===n(t).valueList.length||n(t).valueList.length%2?n(t).median=n(t).valueList[r]:n(t).median=(n(t).valueList[r-1]+n(t).valueList[r])/2,t)}},se=function(e,n){return function(r){return r=e(r),n(r).median=void 0,r}},le=function(e,n){return function(r,t,u){return e&&e(r,t,u),n(r).min=n(r).valueList[0],r}},ve=function(e,n){return function(r,t,u){return e&&e(r,t,u),0===n(r).valueList.length?(n(r).min=void 0,r):(n(r).min=n(r).valueList[0],r)}},he=function(e,n){return function(r){return r=e(r),n(r).min=void 0,r}},de=function(e,n){return function(r,t,u){return e&&e(r,t,u),n(r).max=n(r).valueList[n(r).valueList.length-1],r}},pe=function(e,n){return function(r,t,u){return e&&e(r,t,u),0===n(r).valueList.length?(n(r).max=void 0,r):(n(r).max=n(r).valueList[n(r).valueList.length-1],r)}},ge=function(e,n){return function(r){return r=e(r),n(r).max=void 0,r}};if("undefined"!=typeof Uint8Array)var me=function(e){return new Uint8Array(e)},ye=function(e,n){if(e.length>=n)return e;var r=new e.constructor(n);return r.set(e),r},xe=function(e,n){var r,t;switch(n){case 16:t=e.length,r=new Uint16Array(t);break;case 32:r=function(e){return new Uint32Array(e)}(e.length);break;default:throw new Error("invalid array width!")}return r.set(e),r};function be(e){for(var n=new Array(e),r=-1;++r<e;)n[r]=0;return n}function Ae(e){this.length=e,this.subarrays=1,this.width=8,this.masks={0:0},this[0]=me(e)}Ae.prototype.lengthen=function(e){var n,r;for(n=0,r=this.subarrays;n<r;++n)this[n]=ye(this[n],e);this.length=e},Ae.prototype.add=function(){var e,n,r,t,u;for(t=0,u=this.subarrays;t<u;++t)if(r=(~(e=this.masks[t])&e+1)>>>0,!((n=this.width-32*t)>=32)||r)return n<32&&r&1<<n&&(this[t]=xe(this[t],n<<=1),this.width=32*t+n),this.masks[t]|=r,{offset:t,one:r};return this[this.subarrays]=me(this.length),this.masks[this.subarrays]=1,this.width+=8,{offset:this.subarrays++,one:1}},Ae.prototype.copy=function(e,n){var r,t;for(r=0,t=this.subarrays;r<t;++r)this[r][e]=this[r][n]},Ae.prototype.truncate=function(e){var n,r;for(n=0,r=this.subarrays;n<r;++n)for(var t=this.length-1;t>=e;t--)this[n][t]=0;this.length=e},Ae.prototype.zero=function(e){var n,r;for(n=0,r=this.subarrays;n<r;++n)if(this[n][e])return!1;return!0},Ae.prototype.zeroExcept=function(e,n,r){var t,u;for(t=0,u=this.subarrays;t<u;++t)if(t===n?this[t][e]&r:this[t][e])return!1;return!0},Ae.prototype.zeroExceptMask=function(e,n){var r,t;for(r=0,t=this.subarrays;r<t;++r)if(this[r][e]&n[r])return!1;return!0},Ae.prototype.only=function(e,n,r){var t,u;for(t=0,u=this.subarrays;t<u;++t)if(this[t][e]!=(t===n?r:0))return!1;return!0},Ae.prototype.onlyExcept=function(e,n,r,t,u){var i,o,a;for(o=0,a=this.subarrays;o<a;++o)if(i=this[o][e],o===n&&(i&=r),i!=(o===t?u:0))return!1;return!0};var ke={array8:be,array16:be,array32:be,arrayLengthen:function(e,n){for(var r=e.length;r<n;)e[r++]=0;return e},arrayWiden:function(e,n){if(n>32)throw new Error("invalid array width!");return e},bitarray:Ae};var Oe=(e,n)=>function(r){var t=r.length;return[e.left(r,n,0,t),e.right(r,n,0,t)]},Le=(e,n)=>{var r=n[0],t=n[1];return function(n){var u=n.length;return[e.left(n,r,0,u),e.left(n,t,0,u)]}},we=e=>[0,e.length],Ee=e=>e,Se=()=>null,Pe=()=>0;function $e(e){function n(e,n,t){for(var u=t-n,i=1+(u>>>1);--i>0;)r(e,i,u,n);return e}function r(n,r,t,u){for(var i,o=n[--u+r],a=e(o);(i=r<<1)<=t&&(i<t&&e(n[u+i])>e(n[u+i+1])&&i++,!(a<=e(n[u+i])));)n[u+r]=n[u+i],r=i;n[u+r]=o}return n.sort=function(e,n,t){for(var u,i=t-n;--i>0;)u=e[n],e[n]=e[n+i],e[n+i]=u,r(e,1,i,n);return e},n}const Re=$e(Ee);function ze(e){var n=Re.by(e);return function(r,t,u,i){var o,a,c,f=new Array(i=Math.min(u-t,i));for(a=0;a<i;++a)f[a]=r[t++];if(n(f,0,i),t<u){o=e(f[0]);do{e(c=r[t])>o&&(f[0]=c,o=e(n(f,0,i)[0]))}while(++t<u)}return f}}Re.by=$e;const Ie=ze(Ee);function je(e){function n(n,r,t,u){for(;t<u;){var i=t+u>>>1;r<e(n[i])?u=i:t=i+1}return t}return n.right=n,n.left=function(n,r,t,u){for(;t<u;){var i=t+u>>>1;e(n[i])<r?t=i+1:u=i}return t},n}Ie.by=ze;const qe=je(Ee);function Ce(e){return function(n,r,t){for(var u=r+1;u<t;++u){for(var i=u,o=n[u],a=e(o);i>r&&e(n[i-1])>a;--i)n[i]=n[i-1];n[i]=o}return n}}qe.by=je;const Me=Ce(Ee);Me.by=Ce;var Fe=(e,n,r)=>{for(var t=0,u=n.length,i=r?JSON.parse(JSON.stringify(e)):new Array(u);t<u;++t)i[t]=e[n[t]];return i};function Ne(e){var n=Me.by(e);function r(e,r,u){return(u-r<Ke?n:t)(e,r,u)}function t(n,t,u){var i,o=(u-t)/6|0,a=t+o,c=u-1-o,f=t+u-1>>1,s=f-o,l=f+o,v=n[a],h=e(v),d=n[s],p=e(d),g=n[f],m=e(g),y=n[l],x=e(y),b=n[c],A=e(b);h>p&&(i=v,v=d,d=i,i=h,h=p,p=i),x>A&&(i=y,y=b,b=i,i=x,x=A,A=i),h>m&&(i=v,v=g,g=i,i=h,h=m,m=i),p>m&&(i=d,d=g,g=i,i=p,p=m,m=i),h>x&&(i=v,v=y,y=i,i=h,h=x,x=i),m>x&&(i=g,g=y,y=i,i=m,m=x,x=i),p>A&&(i=d,d=b,b=i,i=p,p=A,A=i),p>m&&(i=d,d=g,g=i,i=p,p=m,m=i),x>A&&(i=y,y=b,b=i,i=x,x=A,A=i);var k=d,O=p,L=y,w=x;n[a]=v,n[s]=n[t],n[f]=g,n[l]=n[u-1],n[c]=b;var E=t+1,S=u-2,P=O<=w&&O>=w;if(P)for(var $=E;$<=S;++$){var R=n[$],z=e(R);if(z<O)$!==E&&(n[$]=n[E],n[E]=R),++E;else if(z>O)for(;;){var I=e(n[S]);if(!(I>O)){if(I<O){n[$]=n[E],n[E++]=n[S],n[S--]=R;break}n[$]=n[S],n[S--]=R;break}S--}}else!function(){for(var r=E;r<=S;r++){var t=n[r],u=e(t);if(u<O)r!==E&&(n[r]=n[E],n[E]=t),++E;else if(u>w)for(;;){var i=e(n[S]);if(!(i>w)){i<O?(n[r]=n[E],n[E++]=n[S],n[S--]=t):(n[r]=n[S],n[S--]=t);break}if(--S<r)break}}}();return n[t]=n[E-1],n[E-1]=k,n[u-1]=n[S+1],n[S+1]=L,r(n,t,E-1),r(n,S+2,u),P?n:(E<a&&S>c&&function(){for(var r,t;(r=e(n[E]))<=O&&r>=O;)++E;for(;(t=e(n[S]))<=w&&t>=w;)--S;for(var u=E;u<=S;u++){var i=n[u],o=e(i);if(o<=O&&o>=O)u!==E&&(n[u]=n[E],n[E]=i),E++;else if(o<=w&&o>=w)for(;;){if(!((t=e(n[S]))<=w&&t>=w)){t<O?(n[u]=n[E],n[E++]=n[S],n[S--]=i):(n[u]=n[S],n[S--]=i);break}if(--S<u)break}}}(),r(n,E,S+1))}return r}var Ke=32;const Ue=Ne(Ee);Ue.by=Ne;var Be=e=>e+1,Ve=e=>e-1,Je=e=>function(n,r){return n+ +e(r)},Te=e=>function(n,r){return n-e(r)};const We=(e,n)=>{const r=e[n];return"function"==typeof r?r.call(e):r},De=/\[([\w\d]+)\]/g;var Ye=(e,n)=>V(We,e,n.replace(De,".$1"));function Ge(){var e,n={add:c,remove:f,dimension:v,groupAll:h,size:d,all:p,allFiltered:g,onChange:m,isElementFiltered:l},r=[],t=0,u=[],i=[],o=[],a=[];function c(u){var o=t,a=u.length;return a&&(r=r.concat(u),e.lengthen(t+=a),i.forEach((function(e){e(u,o,a)})),y("dataAdded")),n}function f(n){for(var i,a=Xe(t,t),c=[],f="function"==typeof n,s=0,l=0;s<t;++s)i=s,(f?n(r[i],i):e.zero(i))?(c.push(s),a[s]=-1):a[s]=l++;u.forEach((function(e){e(-1,-1,[],c,!0)})),o.forEach((function(e){e(a)}));for(var v=0,h=0;v<t;++v)-1!==a[v]&&(v!==h&&(e.copy(h,v),r[h]=r[v]),++h);r.length=t=h,e.truncate(h),y("dataRemoved")}function s(n){var r,t,u,i,o=Array(e.subarrays);for(r=0;r<e.subarrays;r++)o[r]=-1;for(t=0,u=n.length;t<u;t++)o[(i=n[t].id())>>7]&=~(1<<(63&i));return o}function l(n,r){var t=s(r||[]);return e.zeroExceptMask(n,t)}function v(n,a){if("string"==typeof n){var c=n;n=function(e){return Ye(e,c)}}var f,s,l,v,h,d,p,g,m,x,b,A,k,O,L,w,E={filter:function(e){return null==e?V():Array.isArray(e)?B(e):"function"==typeof e?J(e):U(e)},filterExact:U,filterRange:B,filterFunction:J,filterAll:V,currentFilter:function(){return O},hasCurrentFilter:function(){return L},top:function(n,t){var u,i=[],o=j,c=0;t&&t>0&&(c=t);for(;--o>=I&&n>0;)e.zero(u=d[o])&&(c>0?--c:(i.push(r[u]),--n));if(a)for(o=0;o<S.length&&n>0;o++)e.zero(u=S[o])&&(c>0?--c:(i.push(r[u]),--n));return i},bottom:function(n,t){var u,i,o=[],c=0;t&&t>0&&(c=t);if(a)for(u=0;u<S.length&&n>0;u++)e.zero(i=S[u])&&(c>0?--c:(o.push(r[i]),--n));u=I;for(;u<j&&n>0;)e.zero(i=d[u])&&(c>0?--c:(o.push(r[i]),--n)),u++;return o},group:W,groupAll:function(){var e=W(Se),n=e.all;return delete e.all,delete e.top,delete e.order,delete e.orderNatural,delete e.size,e.value=function(){return n()[0].value},e},dispose:D,remove:D,accessor:n,id:function(){return v}},S=[],P=Ue.by((function(e){return p[e]})),$=we,R=[],z=[],I=0,j=0,q=0;i.unshift(M),i.push(F),o.push(N);var C=e.add();function M(r,u,i){if(a){q=0,V=0,w=[];for(var o=0;o<r.length;o++)for(V=0,w=n(r[o]);V<w.length;V++)q++;p=[],x=He(r.length),A=Xe(q,1);for(var c=He(q),s=0,v=0;v<r.length;v++)if((w=n(r[v])).length)for(x[v]=w.length,V=0;V<w.length;V++)p.push(w[V]),c[s]=v,s++;else x[v]=0,S.push(v+u);var y=P(He(q),0,q);p=Fe(p,y),g=Fe(c,y)}else p=r.map(n),g=P(He(i),0,i),p=Fe(p,g);a&&(i=q);var O=$(p),L=O[0],E=O[1];if(k)for(var R=0;R<i;++R)k(p[R],R)||(e[l][g[R]+u]|=f,a&&(A[R]=1));else{for(var z=0;z<L;++z)e[l][g[z]+u]|=f,a&&(A[z]=1);for(var C=E;C<i;++C)e[l][g[C]+u]|=f,a&&(A[C]=1)}if(!u)return h=p,d=g,m=x,b=A,I=L,void(j=E);var M,F=h,N=d,K=b,U=0;if(o=0,a&&(M=u,u=F.length,i=q),h=new Array(a?u+i:t),d=a?new Array(u+i):Xe(t,t),a&&(b=Xe(u+i,1)),a){var B=m.length;m=ke.arrayLengthen(m,t);for(var V=0;V+B<t;V++)m[V+B]=x[V]}for(var J=0;o<u&&U<i;++J)F[o]<p[U]?(h[J]=F[o],a&&(b[J]=K[o]),d[J]=N[o++]):(h[J]=p[U],a&&(b[J]=A[U]),d[J]=g[U++]+(a?M:u));for(;o<u;++o,++J)h[J]=F[o],a&&(b[J]=K[o]),d[J]=N[o];for(;U<i;++U,++J)h[J]=p[U],a&&(b[J]=A[U]),d[J]=g[U]+(a?M:u);O=$(h),I=O[0],j=O[1]}function F(e,n,r){R.forEach((function(e){e(p,g,n,r)})),p=g=null}function N(e){if(a){for(var n=0,r=0;n<S.length;n++)-1!==e[S[n]]&&(S[r]=e[S[n]],r++);for(S.length=r,n=0,r=0;n<t;n++)-1!==e[n]&&(r!==n&&(m[r]=m[n]),r++);m.length=r}for(var u,i=h.length,o=0,c=0;o<i;++o)-1!==e[u=d[o]]&&(o!==c&&(h[c]=h[o]),d[c]=e[u],a&&(b[c]=b[o]),++c);for(h.length=c,a&&(b.length=c);c<i;)d[c++]=0;var f=$(h);I=f[0],j=f[1]}function K(n){var r=n[0],t=n[1];if(k)return k=null,T((function(e,n){return r<=n&&n<t}),0===n[0]&&n[1]===h.length),I=r,j=t,E;var i,o,c,s=[],v=[],p=[],g=[];if(r<I)for(i=r,o=Math.min(I,t);i<o;++i)s.push(d[i]),p.push(i);else if(r>I)for(i=I,o=Math.min(r,j);i<o;++i)v.push(d[i]),g.push(i);if(t>j)for(i=Math.max(r,j),o=t;i<o;++i)s.push(d[i]),p.push(i);else if(t<j)for(i=Math.max(I,t),o=j;i<o;++i)v.push(d[i]),g.push(i);if(a){var x=[],A=[];for(i=0;i<s.length;i++)m[s[i]]++,b[p[i]]=0,1===m[s[i]]&&(e[l][s[i]]^=f,x.push(s[i]));for(i=0;i<v.length;i++)m[v[i]]--,b[g[i]]=1,0===m[v[i]]&&(e[l][v[i]]^=f,A.push(v[i]));if(s=x,v=A,0===n[0]&&n[1]===h.length)for(i=0;i<S.length;i++)e[l][c=S[i]]&f&&(e[l][c]^=f,s.push(c));else for(i=0;i<S.length;i++)e[l][c=S[i]]&f||(e[l][c]^=f,v.push(c))}else{for(i=0;i<s.length;i++)e[l][s[i]]^=f;for(i=0;i<v.length;i++)e[l][v[i]]^=f}return I=r,j=t,u.forEach((function(e){e(f,l,s,v)})),y("filtered"),E}function U(e){return O=e,L=!0,K(($=Oe(qe,e))(h))}function B(e){return O=e,L=!0,K(($=Le(qe,e))(h))}function V(){return O=void 0,L=!1,K(($=we)(h))}function J(e){O=e,L=!0,k=e,$=we,T(e,!1);var n=$(h);return I=n[0],j=n[1],E}function T(n,r){var t,i,o,c=[],v=[],p=[],g=[],x=h.length;if(!a)for(t=0;t<x;++t)!(e[l][i=d[t]]&f)^!!(o=n(h[t],t))&&(o?c.push(i):v.push(i));if(a)for(t=0;t<x;++t)n(h[t],t)?(c.push(d[t]),p.push(t)):(v.push(d[t]),g.push(t));if(a){var A=[],k=[];for(t=0;t<c.length;t++)1===b[p[t]]&&(m[c[t]]++,b[p[t]]=0,1===m[c[t]]&&(e[l][c[t]]^=f,A.push(c[t])));for(t=0;t<v.length;t++)0===b[g[t]]&&(m[v[t]]--,b[g[t]]=1,0===m[v[t]]&&(e[l][v[t]]^=f,k.push(v[t])));if(c=A,v=k,r)for(t=0;t<S.length;t++)e[l][i=S[t]]&f&&(e[l][i]^=f,c.push(i));else for(t=0;t<S.length;t++)e[l][i=S[t]]&f||(e[l][i]^=f,v.push(i))}else{for(t=0;t<c.length;t++)e[l][c[t]]&f&&(e[l][c[t]]&=s);for(t=0;t<v.length;t++)e[l][v[t]]&f||(e[l][v[t]]|=f)}u.forEach((function(e){e(f,l,c,v)})),y("filtered")}function W(n){var i={top:F,all:M,reduce:N,reduceCount:K,reduceSum:U,order:B,orderNatural:V,size:J,dispose:T,remove:T};z.push(i);var c,v,p,g,m,y,x,b,A=8,k=Qe(A),O=0,L=Se,w=Se,E=!0,S=n===Se;function P(i,o,f,d){a&&(b=f,f=h.length-i.length,d=i.length);var p,g,P,$,R,z,M=c,F=a?[]:Xe(O,k),N=m,K=y,U=x,B=O,V=0,J=0;for(E&&(N=U=Se),E&&(K=U=Se),c=new Array(O),O=0,v=a?B?v:[]:B>1?ke.arrayLengthen(v,t):Xe(t,k),B&&(P=(g=M[0]).key);J<d&&!(($=n(i[J]))>=$);)++J;for(;J<d;){for(g&&P<=$?(R=g,z=P,F[V]=O,(g=M[++V])&&(P=g.key)):(R={key:$,value:U()},z=$),c[O]=R;$<=z&&(p=o[J]+(a?b:f),a?v[p]?v[p].push(O):v[p]=[O]:v[p]=O,R.value=N(R.value,r[p],!0),e.zeroExcept(p,l,s)||(R.value=K(R.value,r[p],!1)),!(++J>=d));)$=n(i[J]);W()}for(;V<B;)c[F[V]=O]=M[V++],W();if(a)for(var T=0;T<t;T++)v[T]||(v[T]=[]);if(O>V)if(a)for(V=0;V<b;++V)for(T=0;T<v[V].length;T++)v[V][T]=F[v[V][T]];else for(V=0;V<f;++V)v[V]=F[v[V]];function W(){a?O++:++O===k&&(F=ke.arrayWiden(F,A<<=1),v=ke.arrayWiden(v,A),k=Qe(A))}p=u.indexOf(L),O>1||a?(L=I,w=q):(!O&&S&&(O=1,c=[{key:null,value:U()}]),1===O?(L=j,w=C):(L=Se,w=Se),v=null),u[p]=L}function $(e){if(O>1||a){var n,r,i,o=O,f=c,s=Xe(o,o);if(a){for(n=0,i=0;n<t;++n)if(-1!==e[n]){for(v[i]=v[n],r=0;r<v[i].length;r++)s[v[i][r]]=1;++i}}else for(n=0,i=0;n<t;++n)-1!==e[n]&&(s[v[i]=v[n]]=1,++i);for(c=[],O=0,n=0;n<o;++n)s[n]&&(s[n]=O++,c.push(f[n]));if(O>1||a)if(a)for(n=0;n<i;++n)for(r=0;r<v[n].length;++r)v[n][r]=s[v[n][r]];else for(n=0;n<i;++n)v[n]=s[v[n]];else v=null;u[u.indexOf(L)]=O>1||a?(w=q,L=I):1===O?(w=C,L=j):w=L=Se}else if(1===O){if(S)return;for(var l=0;l<t;++l)if(-1!==e[l])return;c=[],O=0,u[u.indexOf(L)]=L=w=Se}}function I(n,t,u,i,o){var h,d,p,g,x;if(!(n===f&&t===l||E))if(a){for(h=0,g=u.length;h<g;++h)if(e.zeroExcept(p=u[h],l,s))for(d=0;d<v[p].length;d++)(x=c[v[p][d]]).value=m(x.value,r[p],!1,d);for(h=0,g=i.length;h<g;++h)if(e.onlyExcept(p=i[h],l,s,t,n))for(d=0;d<v[p].length;d++)(x=c[v[p][d]]).value=y(x.value,r[p],o,d)}else{for(h=0,g=u.length;h<g;++h)e.zeroExcept(p=u[h],l,s)&&((x=c[v[p]]).value=m(x.value,r[p],!1));for(h=0,g=i.length;h<g;++h)e.onlyExcept(p=i[h],l,s,t,n)&&((x=c[v[p]]).value=y(x.value,r[p],o))}}function j(n,t,u,i,o){if(!(n===f&&t===l||E)){var a,v,h,d=c[0];for(a=0,h=u.length;a<h;++a)e.zeroExcept(v=u[a],l,s)&&(d.value=m(d.value,r[v],!1));for(a=0,h=i.length;a<h;++a)e.onlyExcept(v=i[a],l,s,t,n)&&(d.value=y(d.value,r[v],o))}}function q(){var n,u,i;for(n=0;n<O;++n)c[n].value=x();if(a){for(n=0;n<t;++n)for(u=0;u<v[n].length;u++)(i=c[v[n][u]]).value=m(i.value,r[n],!0,u);for(n=0;n<t;++n)if(!e.zeroExcept(n,l,s))for(u=0;u<v[n].length;u++)(i=c[v[n][u]]).value=y(i.value,r[n],!1,u)}else{for(n=0;n<t;++n)(i=c[v[n]]).value=m(i.value,r[n],!0);for(n=0;n<t;++n)e.zeroExcept(n,l,s)||((i=c[v[n]]).value=y(i.value,r[n],!1))}}function C(){var n,u=c[0];for(u.value=x(),n=0;n<t;++n)u.value=m(u.value,r[n],!0);for(n=0;n<t;++n)e.zeroExcept(n,l,s)||(u.value=y(u.value,r[n],!1))}function M(){return E&&(w(),E=!1),c}function F(e){var n=p(M(),0,c.length,e);return g.sort(n,0,n.length)}function N(e,n,r){return m=e,y=n,x=r,E=!0,i}function K(){return N(Be,Ve,Pe)}function U(e){return N(Je(e),Te(e),Pe)}function B(e){function n(n){return e(n.value)}return p=Ie.by(n),g=Re.by(n),i}function V(){return B(Ee)}function J(){return O}function T(){var e=u.indexOf(L);return e>=0&&u.splice(e,1),(e=R.indexOf(P))>=0&&R.splice(e,1),(e=o.indexOf($))>=0&&o.splice(e,1),(e=z.indexOf(i))>=0&&z.splice(e,1),i}return arguments.length<1&&(n=Ee),u.push(L),R.push(P),o.push($),P(h,d,0,t),K().orderNatural()}function D(){z.forEach((function(e){e.dispose()}));var n=i.indexOf(M);return n>=0&&i.splice(n,1),(n=i.indexOf(F))>=0&&i.splice(n,1),(n=o.indexOf(N))>=0&&o.splice(n,1),e.masks[l]&=s,V()}return l=C.offset,f=C.one,s=~f,v=l<<7|Math.log(f)/Math.log(2),M(r,0,t),F(r,0,t),E}function h(){var n,o,a,c,f={reduce:h,reduceCount:d,reduceSum:function(e){return h(Je(e),Te(e),Pe)},value:function(){s&&(function(){var u;for(n=c(),u=0;u<t;++u)n=o(n,r[u],!0),e.zero(u)||(n=a(n,r[u],!1))}(),s=!1);return n},dispose:p,remove:p},s=!0;function l(u,i){var c;if(!s)for(c=i;c<t;++c)n=o(n,r[c],!0),e.zero(c)||(n=a(n,r[c],!1))}function v(t,u,i,c,f){var l,v,h;if(!s){for(l=0,h=i.length;l<h;++l)e.zero(v=i[l])&&(n=o(n,r[v],f));for(l=0,h=c.length;l<h;++l)e.only(v=c[l],u,t)&&(n=a(n,r[v],f))}}function h(e,n,r){return o=e,a=n,c=r,s=!0,f}function d(){return h(Be,Ve,Pe)}function p(){var e=u.indexOf(v);return e>=0&&u.splice(e,1),(e=i.indexOf(l))>=0&&i.splice(e,1),f}return u.push(v),i.push(l),l(r,0),d()}function d(){return t}function p(){return r}function g(n){var u=[],i=0,o=s(n||[]);for(i=0;i<t;i++)e.zeroExceptMask(i,o)&&u.push(r[i]);return u}function m(e){if("function"==typeof e)return a.push(e),function(){a.splice(a.indexOf(e),1)};console.warn("onChange callback parameter must be a function!")}function y(e){for(var n=0;n<a.length;n++)a[n](e)}return e=new ke.bitarray(0),arguments.length?c(arguments[0]):n}function Xe(e,n){return(n<257?ke.array8:n<65537?ke.array16:ke.array32)(e)}function He(e){for(var n=Xe(e,e),r=-1;++r<e;)n[r]=r;return n}function Qe(e){return 8===e?256:16===e?65536:4294967296}Ge.heap=Re,Ge.heapselect=Ie,Ge.bisect=qe,Ge.insertionsort=Me,Ge.permute=Fe,Ge.quicksort=Ue;var Ze=function(e,n,r){var t,u;return function(i,o,a){return n&&n(i,o,a),t=r(i).bisect(r(i).values,e(o),0,r(i).values.length),(u=r(i).values[t])&&u[0]===e(o)?u[1]++:r(i).values.splice(t,0,[e(o),1]),i}},_e=function(e,n,r){var t;return function(u,i,o){return n&&n(u,i,o),t=r(u).bisect(r(u).values,e(i),0,r(u).values.length),r(u).values[t][1]--,u}},en=function(e,n){return function(r){return r=e(r),n(r).values=[],n(r).bisect=Ge.bisect.by((function(e){return e[0]})).left,r}},nn=function(e,n,r){var t,u=Ge.bisect.by((function(e){return e})).left;return function(i,o,a){return n&&n(i,o,a),t=u(r(i).valueList,e(o),0,r(i).valueList.length),r(i).valueList.splice(t,0,e(o)),i}},rn=function(e,n,r){var t,u=Ge.bisect.by((function(e){return e})).left;return function(i,o,a){return n&&n(i,o,a),t=u(r(i).valueList,e(o),0,r(i).valueList.length),r(i).valueList.splice(t,1),i}},tn=function(e,n){return function(r){return r=e(r),n(r).valueList=[],r}},un=function(e,n,r){var t,u;return function(i,o,a){return n&&n(i,o,a),t=r(i).bisect(r(i).values,e(o),0,r(i).values.length),(u=r(i).values[t])&&u[0]===e(o)&&0!==u[1]||r(i).exceptionCount++,i}},on=function(e,n,r){var t,u;return function(i,o,a){return n&&n(i,o,a),t=r(i).bisect(r(i).values,e(o),0,r(i).values.length),(u=r(i).values[t])&&u[0]===e(o)&&1===u[1]&&r(i).exceptionCount--,i}},an=function(e,n){return function(r){return r=e(r),n(r).exceptionCount=0,r}},cn=function(e,n,r,t){var u,i;return function(o,a,c){return r&&r(o,a,c),u=t(o).bisect(t(o).values,e(a),0,t(o).values.length),(i=t(o).values[u])&&i[0]===e(a)&&0!==i[1]||(t(o).exceptionSum=t(o).exceptionSum+n(a)),o}},fn=function(e,n,r,t){var u,i;return function(o,a,c){return r&&r(o,a,c),u=t(o).bisect(t(o).values,e(a),0,t(o).values.length),(i=t(o).values[u])&&i[0]===e(a)&&1===i[1]&&(t(o).exceptionSum=t(o).exceptionSum-n(a)),o}},sn=function(e,n){return function(r){return r=e(r),n(r).exceptionSum=0,r}},ln=function(e,n,r){var t,u=Ge.bisect.by((function(e){return e})).left,i=Ge.bisect.by((function(e){return e.x})).right;return function(o,a,c){return n&&n(o,a,c),(t=r(o).histogram[i(r(o).histogram,e(a),0,r(o).histogram.length)-1]).y++,t.splice(u(t,e(a),0,t.length),0,e(a)),o}},vn=function(e,n,r){var t,u=Ge.bisect.by((function(e){return e})).left,i=Ge.bisect.by((function(e){return e.x})).right;return function(o,a,c){return n&&n(o,a,c),(t=r(o).histogram[i(r(o).histogram,e(a),0,r(o).histogram.length)-1]).y--,t.splice(u(t,e(a),0,t.length),1),o}},hn=function(e,n,r){return function(t){t=n(t),r(t).histogram=[];for(var u=[],i=1;i<e.length;i++)(u=[]).x=e[i-1],u.dx=e[i]-e[i-1],u.y=0,r(t).histogram.push(u);return t}},dn=function(e,n,r){return function(t,u,i){return n&&n(t,u,i),r(t).sumOfSq=r(t).sumOfSq+e(u)*e(u),t}},pn=function(e,n,r){return function(t,u,i){return n&&n(t,u,i),r(t).sumOfSq=r(t).sumOfSq-e(u)*e(u),t}},gn=function(e,n){return function(r){return r=e(r),n(r).sumOfSq=0,r}},mn=function(e,n){return function(r,t,u){if(e&&e(r,t,u),n(r).count>0){n(r).std=0;var i=n(r).sumOfSq-n(r).sum*n(r).sum/n(r).count;i>0&&(n(r).std=Math.sqrt(i/(n(r).count-1)))}else n(r).std=0;return r}},yn=function(e,n){return function(r,t,u){if(e&&e(r,t,u),n(r).count>0){n(r).std=0;var i=n(r).sumOfSq-n(r).sum*n(r).sum/n(r).count;i>0&&(n(r).std=Math.sqrt(i/(n(r).count-1)))}else n(r).std=0;return r}},xn=function(e,n){return function(r){return r=e(r),n(r).std=0,r}},bn=function(e,n,r){var t,u;return function(i,o,a){return n&&n(i,o,a),t=r(i).nest,e.forEach((function(e){(u=t.filter((function(n){return n.key===e(o)}))[0])?t=u.values:(u=[],t.push({key:e(o),values:u}),t=u)})),t.push(o),i}},An=function(e,n,r){var t;return function(u,i,o){return n&&n(u,i,o),t=r(u).nest,e.forEach((function(e){t=t.filter((function(n){return n.key===e(i)}))[0].values})),t.splice(t.indexOf(i),1),u}},kn=function(e,n){return function(r){return r=e(r),n(r).nest=[],r}},On=function(e,n,r){return function(t){function u(e){return function(){return r[e](n(t))}}for(var i in e&&(t=e(t)),r)n(t)[i]=u(i);return t}},Ln=function(e,n,r){return function(t,u,i){for(var o in n&&n(t,u,i),e)r(t)[o]=e[o](r(t),u);return t}},wn=function(e,n,r){return function(e,t,u){return n&&n(e,t,u),r(e).dataList.push(t),e}},En=function(e,n,r){return function(e,t,u){return n&&n(e,t,u),r(e).dataList.splice(r(e).dataList.indexOf(t),1),e}},Sn=function(e,n){return function(r){return e&&(r=e(r)),n(r).dataList=[],r}},Pn=function(e,n,r){return function(n,t,u){return e&&e(n,t,u),r(n,t)}},$n=function(e,n,r){return function(n,t,u){return e&&e(n,t,u),r(n,t)}},Rn=function(e,n,r){return function(n){return e&&(n=e(n)),r(n)}};var zn={build:function e(n,r,t){t||(t=function(e){return e});var u={reduceAdd:r.reduceAdd,reduceRemove:r.reduceRemove,reduceInitial:r.reduceInitial};(n.count||n.std)&&(r.reduceAdd=_(r.reduceAdd,t,n.count),r.reduceRemove=ee(r.reduceRemove,t,n.count),r.reduceInitial=ne(r.reduceInitial,t,n.count)),n.sum&&(r.reduceAdd=re(n.sum,r.reduceAdd,t),r.reduceRemove=te(n.sum,r.reduceRemove,t),r.reduceInitial=ue(r.reduceInitial,t)),n.avg&&(n.count&&n.sum?(r.reduceAdd=ie(n.sum,r.reduceAdd,t),r.reduceRemove=oe(n.sum,r.reduceRemove,t),r.reduceInitial=ae(r.reduceInitial,t)):console.error("You must set .count(true) and define a .sum(accessor) to use .avg(true).")),n.exceptionCount&&(n.exceptionAccessor?(r.reduceAdd=un(n.exceptionAccessor,r.reduceAdd,t),r.reduceRemove=on(n.exceptionAccessor,r.reduceRemove,t),r.reduceInitial=an(r.reduceInitial,t)):console.error("You must define an .exception(accessor) to use .exceptionCount(true).")),n.exceptionSum&&(n.exceptionAccessor?(r.reduceAdd=cn(n.exceptionAccessor,n.exceptionSum,r.reduceAdd,t),r.reduceRemove=fn(n.exceptionAccessor,n.exceptionSum,r.reduceRemove,t),r.reduceInitial=sn(r.reduceInitial,t)):console.error("You must define an .exception(accessor) to use .exceptionSum(accessor).")),(n.valueList||n.median||n.min||n.max)&&(r.reduceAdd=nn(n.valueList,r.reduceAdd,t),r.reduceRemove=rn(n.valueList,r.reduceRemove,t),r.reduceInitial=tn(r.reduceInitial,t)),n.dataList&&(r.reduceAdd=wn(n.dataList,r.reduceAdd,t),r.reduceRemove=En(n.dataList,r.reduceRemove,t),r.reduceInitial=Sn(r.reduceInitial,t)),n.median&&(r.reduceAdd=ce(r.reduceAdd,t),r.reduceRemove=fe(r.reduceRemove,t),r.reduceInitial=se(r.reduceInitial,t)),n.min&&(r.reduceAdd=le(r.reduceAdd,t),r.reduceRemove=ve(r.reduceRemove,t),r.reduceInitial=he(r.reduceInitial,t)),n.max&&(r.reduceAdd=de(r.reduceAdd,t),r.reduceRemove=pe(r.reduceRemove,t),r.reduceInitial=ge(r.reduceInitial,t)),n.exceptionAccessor&&(r.reduceAdd=Ze(n.exceptionAccessor,r.reduceAdd,t),r.reduceRemove=_e(n.exceptionAccessor,r.reduceRemove,t),r.reduceInitial=en(r.reduceInitial,t)),n.histogramValue&&n.histogramThresholds&&(r.reduceAdd=ln(n.histogramValue,r.reduceAdd,t),r.reduceRemove=vn(n.histogramValue,r.reduceRemove,t),r.reduceInitial=hn(n.histogramThresholds,r.reduceInitial,t)),n.sumOfSquares&&(r.reduceAdd=dn(n.sumOfSquares,r.reduceAdd,t),r.reduceRemove=pn(n.sumOfSquares,r.reduceRemove,t),r.reduceInitial=gn(r.reduceInitial,t)),n.std&&(n.sumOfSquares&&n.sum?(r.reduceAdd=mn(r.reduceAdd,t),r.reduceRemove=yn(r.reduceRemove,t),r.reduceInitial=xn(r.reduceInitial,t)):console.error("You must set .sumOfSq(accessor) and define a .sum(accessor) to use .std(true). Or use .std(accessor).")),n.custom&&(r.reduceAdd=Pn(r.reduceAdd,t,n.custom.add),r.reduceRemove=$n(r.reduceRemove,t,n.custom.remove),r.reduceInitial=Rn(r.reduceInitial,t,n.custom.initial)),n.nestKeys&&(r.reduceAdd=bn(n.nestKeys,r.reduceAdd,t),r.reduceRemove=An(n.nestKeys,r.reduceRemove,t),r.reduceInitial=kn(r.reduceInitial,t)),n.aliasKeys&&(r.reduceInitial=On(r.reduceInitial,t,n.aliasKeys)),n.aliasPropKeys&&(r.reduceAdd=Ln(n.aliasPropKeys,r.reduceAdd,t),r.reduceRemove=Ln(n.aliasPropKeys,r.reduceRemove,t)),n.filter&&(r.reduceAdd=Q(n.filter,r.reduceAdd,u.reduceAdd,t),r.reduceRemove=Z(n.filter,r.reduceRemove,u.reduceRemove,t)),n.values&&Object.getOwnPropertyNames(n.values).forEach((function(u){var i;r.reduceInitial=(i=r.reduceInitial,function(e){return e=i(e),t(e)[u]={},e}),e(n.values[u].parameters,r,(function(e){return e[u]}))}))}};function In(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),r=1;r<arguments.length;++r){var t=arguments[r];if(null!=t)for(var u in t)t.hasOwnProperty(u)&&(n[u]=t[u])}return n}var jn={build:function e(n,r){function t(e){if("string"==typeof e){var n=e;return function(e){return e[n]}}return e}function u(e){if("string"==typeof e){var n=e;return function(e){return+e[n]}}return e}n.fromObject=function(e){return arguments.length?(In(r,e),n):r},n.toObject=function(){return r},n.count=function(e,t){return arguments.length?(t||(t="count"),r.count=t,n):r.count},n.sum=function(e){return arguments.length?(e=u(e),r.sum=e,n):r.sum},n.avg=function(e){return arguments.length?("function"==typeof(e=u(e))?(r.sum&&r.sum!==e&&console.warn("SUM aggregation is being overwritten by AVG aggregation"),r.sum=e,r.avg=!0,r.count="count"):r.avg=e,n):r.avg},n.exception=function(e){return arguments.length?(e=t(e),r.exceptionAccessor=e,n):r.exceptionAccessor},n.filter=function(e){return arguments.length?(r.filter=e,n):r.filter},n.valueList=function(e){return arguments.length?(e=t(e),r.valueList=e,n):r.valueList},n.median=function(e){return arguments.length?("function"==typeof(e=u(e))&&(r.valueList&&r.valueList!==e&&console.warn("VALUELIST accessor is being overwritten by median aggregation"),r.valueList=e),r.median=e,n):r.median},n.min=function(e){return arguments.length?("function"==typeof(e=u(e))&&(r.valueList&&r.valueList!==e&&console.warn("VALUELIST accessor is being overwritten by min aggregation"),r.valueList=e),r.min=e,n):r.min},n.max=function(e){return arguments.length?("function"==typeof(e=u(e))&&(r.valueList&&r.valueList!==e&&console.warn("VALUELIST accessor is being overwritten by max aggregation"),r.valueList=e),r.max=e,n):r.max},n.exceptionCount=function(e){return arguments.length?("function"==typeof(e=t(e))?(r.exceptionAccessor&&r.exceptionAccessor!==e&&console.warn("EXCEPTION accessor is being overwritten by exception count aggregation"),r.exceptionAccessor=e,r.exceptionCount=!0):r.exceptionCount=e,n):r.exceptionCount},n.exceptionSum=function(e){return arguments.length?(e=u(e),r.exceptionSum=e,n):r.exceptionSum},n.histogramValue=function(e){return arguments.length?(e=u(e),r.histogramValue=e,n):r.histogramValue},n.histogramBins=function(e){return arguments.length?(r.histogramThresholds=e,n):r.histogramThresholds},n.std=function(e){return arguments.length?("function"==typeof(e=u(e))?(r.sumOfSquares=e,r.sum=e,r.count="count",r.std=!0):r.std=e,n):r.std},n.sumOfSq=function(e){return arguments.length?(e=u(e),r.sumOfSquares=e,n):r.sumOfSquares},n.value=function(n,t){if(arguments.length&&"string"==typeof n)return r.values||(r.values={}),r.values[n]={},r.values[n].parameters={order:!1,avg:!1,count:!1,sum:!1,exceptionAccessor:!1,exceptionCount:!1,exceptionSum:!1,filter:!1,valueList:!1,median:!1,histogramValue:!1,min:!1,max:!1,histogramThresholds:!1,std:!1,sumOfSquares:!1,values:!1,nestKeys:!1,aliasKeys:!1,aliasPropKeys:!1,groupAll:!1,dataList:!1,custom:!1},e(r.values[n],r.values[n].parameters),t&&(r.values[n].accessor=t),r.values[n];console.error("'value' requires a string argument.")},n.nest=function(e){return arguments.length?(e.map(t),r.nestKeys=e,n):r.nestKeys},n.alias=function(e){return arguments.length?(r.aliasKeys=e,n):r.aliasKeys},n.aliasProp=function(e){return arguments.length?(r.aliasPropKeys=e,n):r.aliasPropKeys},n.groupAll=function(e){return arguments.length?(r.groupAll=e,n):r.groupAll},n.dataList=function(e){return arguments.length?(r.dataList=e,n):r.dataList},n.custom=function(e){return arguments.length?(r.custom=e,n):r.custom}}};var qn=function(e){return function(n){return n[e]}};const Cn=function(e,n){return e||(e=function(e){return e}),function(r,t){n&&n(r,t);var u=e(r),i=e(t);return void 0!==i.count&&(u.count+=i.count),void 0!==i.sum&&(u.sum+=i.sum),void 0!==i.avg&&(u.avg=u.sum/u.count),r}},Mn=function(e,n,r){n.reduceInitial();var t=r.values?Object.keys(r.values):[],u=Cn();if(t.length)for(var i=0;i<t.length;++i)u=Cn(qn(t[i]),u);return function(r,t){if(!arguments.length)return e();if(r===1/0||!r)return e();var i=e(),o=r-1;if(i.length<=r)return i;var a=i.slice(0,o),c={key:t||"Others"};c.value=n.reduceInitial();for(var f=o;f<i.length;++f)u(c.value,i[f].value);return a.push(c),a}};var Fn=function(e){if("function"==typeof e)return e;if(~e.indexOf(".")){var n=e.split(".");return function(e){return n.reduce((function(e,n){return e[n]}),e)}}return function(n){return n[e]}};function Nn(e,n){return e<n?-1:e>n?1:e>=n?0:NaN}var Kn=function(e,n){return function(r,t){return n(e(r),e(t))}};function Un(e){return function(n,r){return 1===arguments.length&&(r=Nn),e().sort(Kn(Fn(n),r))}}function Bn(){var e={order:!1,avg:!1,count:!1,sum:!1,exceptionAccessor:!1,exceptionCount:!1,exceptionSum:!1,filter:!1,valueList:!1,median:!1,histogramValue:!1,min:!1,max:!1,histogramThresholds:!1,std:!1,sumOfSquares:!1,values:!1,nestKeys:!1,aliasKeys:!1,aliasPropKeys:!1,groupAll:!1,dataList:!1,custom:!1},n={};function r(r){if(n={reduceAdd:function(e){return e},reduceRemove:function(e){return e},reduceInitial:function(){return{}}},zn.build(e,n),e.groupAll)if(r.top)console.warn("'groupAll' is defined but attempting to run on a standard dimension.group(). Must run on dimension.groupAll().");else{var t,u,i,o,a,c=Ge.bisect.by((function(e){return e.key})).left;r.reduce((function(r,f,s){for(i=e.groupAll(f),o=i.length,u=0;u<o;u++)a=i[u],r[t=c(r,a,0,r.length)]&&r[t].key===a||r.splice(t,0,{key:a,value:n.reduceInitial()}),n.reduceAdd(r[t].value,f,s);return r}),(function(r,a,f){for(i=e.groupAll(a),o=i.length,u=0;u<o;u++)t=c(r,i[u],0,r.length),n.reduceRemove(r[t].value,a,f);return r}),(function(){return[]})),r.all||(r.all=function(){return this.value()})}else r.reduce(n.reduceAdd,n.reduceRemove,n.reduceInitial);return Vn(r,e,n),r}return jn.build(r,e),r}!function(e){e.postprocessors={},e.registerPostProcessor=function(n,r){e.postprocessors[n]=r},e.registerPostProcessor("cap",Mn),e.registerPostProcessor("sortBy",Un)}(Bn);const Vn=function(e){return function(n,r,t){n.post=function(){var u=function e(){return e.all()};u.all=function(){return n.all()};var i=e.postprocessors;return Object.keys(i).forEach((function(e){u[e]=function(){var n=u.all,o=[].slice.call(arguments);return u.all=function(){return i[e](n,t,r).apply(null,o)},u}})),u}}}(Bn);var Jn={shorthandLabels:{$count:"count",$sum:"sum",$avg:"avg",$min:"min",$max:"max",$med:"med",$sumSq:"sumSq",$std:"std"},aggregators:{$count:function(e){return e.count(!0)},$sum:function(e,n){return e.sum(n)},$avg:function(e,n){return e.avg(n)},$min:function(e,n){return e.min(n)},$max:function(e,n){return e.max(n)},$med:function(e,n){return e.median(n)},$sumSq:function(e,n){return e.sumOfSq(n)},$std:function(e,n){return e.std(n)},$valueList:function(e,n){return e.valueList(n)},$dataList:function(e){return e.dataList(!0)}}};function Tn(n){return n.locked?e.clone(n.data):n.data}function Wn(n){var r=function(n){var r=d(n);return function(n){var t=Bn();if(function n(r,t){var u=e.sortBy(e.map(t,(function(e,n){return{key:n,value:e}})),(function(e){return Jn.aggregators[e.key]?0:1}));return e.forEach(u,(function(t){if(Jn.aggregators[t.key]){var u=c.makeValueAccessor(t.value);r=Jn.aggregators[t.key](r,u)}else e.isObject(t.value)?n(r.value(t.key),t.value):console.error("Nested selects must be an object",t.key)}))}(t,n.select),n.filter){var u=r.makeFunction(n.filter);u&&t.filter(u)}return Promise.resolve(t)}}(n),t=d(n),u={post:function(e,n,r){return e.data=Tn(n),Promise.resolve(r(e,n))},sortByKey:function(n,r,t){n.data=Tn(r),n.data=e.sortBy(n.data,(function(e){return e.key})),t&&n.data.reverse()},limit:function(n,r,t,u){n.data=Tn(r),e.isUndefined(u)?(u=t||0,t=0):(t=t||0,u=u||n.data.length),n.data=n.data.splice(t,u-t)},squash:function(n,r,t,u,i,o){n.data=Tn(r),t=t||0,u=u||n.data.length;var a=n.data.splice(t,u-t),f={key:o||"Other",value:{}};e.recurseObject(i,(function(n,r,t){var u=[];e.forEach(a,(function(n){u.push(e.get(n.value,t))})),e.set(f.value,t,c.aggregators[n](u))})),n.data.splice(t,0,f)},change:function(n,r,t,u,i){n.data=Tn(r),t=t||0,u=u||n.data.length;var o={key:[n.data[t].key,n.data[u].key],value:{}};e.recurseObject(i,(function(r,i,a){var c=e.clone(a);c.pop(),c.push(i+"Change"),e.set(o.value,c,e.get(n.data[u].value,a)-e.get(n.data[t].value,a))})),n.data=o},changeMap:function(n,r,t,u){u=e.isUndefined(u)?0:u,n.data=Tn(r),e.recurseObject(t,(function(r,t,i){var o=e.clone(i),a=e.clone(i),c=e.clone(i);o.pop(),a.pop(),c.pop(),o.push(t+"Change"),a.push(t+"ChangeFromStart"),c.push(t+"ChangeFromEnd");var f=e.get(n.data[0].value,i,u),s=e.get(n.data[n.data.length-1].value,i,u);e.forEach(n.data,(function(r,t){var l=n.data[t-1]||n.data[0];e.set(n.data[t].value,o,e.get(r.value,i,u)-(l?e.get(l.value,i,u):u)),e.set(n.data[t].value,a,e.get(r.value,i,u)-f),e.set(n.data[t].value,c,e.get(r.value,i,u)-s)}))}))}},i=e.keys(u);return function(o){for(var a=JSON.stringify(o),c=0;c<n.columns.length;c++)for(var f=0;f<n.columns[c].queries.length;f++)if(n.columns[c].queries[f].hash===a)return new Promise((function(e,r){try{e(n.columns[c].queries[f])}catch(e){r(e)}}));var s={original:o,hash:a};return e.isUndefined(s.original)&&(s.original={}),e.isUndefined(s.original.select)&&(s.original.select={$count:!0}),s.original.groupBy=s.original.groupBy||!0,function(r){return n.column({key:r.original.groupBy,type:e.isUndefined(r.type)?null:r.type,array:Boolean(r.array)}).then((function(){var e=n.column.find(r.original.groupBy);return r.column=e,e.queries.push(r),e.removeListeners.push((function(){return r.clear()})),r}))}(s=function r(t,o){var a=!1;o||(o=t,t={},a=!0);return Object.assign(t,{universe:n,crossfilter:n.cf,parent:o,column:o.column,dimension:o.dimension,group:o.group,reducer:o.reducer,original:o.original,hash:o.hash,removeListeners:[],postAggregations:[],locked:a,lock:c,unlock:f,clear:s}),e.forEach(i,(function(e){t[e]=l(u[e])})),t;function c(n){e.isUndefined(n)?t.locked=!0:t.locked=Boolean(n)}function f(){t.locked=!1}function s(){return e.forEach(t.removeListeners,(function(e){e()})),new Promise((function(e,n){try{e(t.group.dispose())}catch(e){n(e)}})).then((function(){if(t.column.queries.splice(t.column.queries.indexOf(t),1),!t.column.queries.length)return n.clear(t.column.key)})).then((function(){return n}))}function l(e){return function(){var n=Array.prototype.slice.call(arguments),u={};return r(u,t),n.unshift(u,t),t.postAggregations.push((function(){Promise.resolve(e.apply(null,n)).then(i)})),Promise.resolve(e.apply(null,n)).then(i);function i(){return d(u).then((function(){return u}))}}}}(s)).then((function(e){return Promise.resolve(e.column.dimension.group()).then((function(n){return e.group=n,e}))})).then((function(r){var u=t.scanForDynamicFilters(r.original);if(u.length)return Promise.all(e.map(u,(function(e){return n.column({key:e,dynamicReference:r.group})}))).then((function(){return r}));return r})).then((function(e){var r=n.onDataChange((function(){return l(e)}));e.removeListeners.push(r);var t=n.onFilter((function(){return d(e)}));return e.removeListeners.push(t),e})).then(l);function l(e){return function(e){return r(e.original).then((function(n){return e.reducer=n,e}))}(e).then(v).then(h).then(d)}function v(e){return Promise.resolve(e.reducer(e.group)).then((function(){return e}))}function h(e){return Promise.resolve(e.group.all()).then((function(n){return e.data=n,e}))}function d(n){return n.postAggregations.length>1&&(n.locked=!0),Promise.all(e.map(n.postAggregations,(function(e){return e()}))).then((function(){return n}))}}}function Dn(n){return function(r){return r&&(r=e.isArray(r)?r:[r]),r?Promise.all(e.map(r,(function(r){e.isObject(r)&&(r=r.key);var u=e.remove(n.columns,(function(n){return e.isArray(r)?!e.xor(n.key,r).length:n.key===r?!n.dynamicReference:void 0}))[0];u&&t(u)}))).then((function(){return n})):Promise.all(e.map(n.columns,t)).then((function(){return n.columns=[],n}));function t(r){var t=[];r.removeListeners&&(t=e.map(r.removeListeners,(function(e){return Promise.resolve(e())})));var u=r.key;return"array"===r.complex&&(u=JSON.stringify(r.key)),"function"===r.complex&&(u=r.key.toString()),delete n.filters[u],r.dimension&&t.push(Promise.resolve(r.dimension.dispose())),Promise.all(t)}}}function Yn(e){return function(){return e.clear().then((function(){return e.cf.dataListeners=[],e.cf.filterListeners=[],Promise.resolve(e.cf.remove())})).then((function(){return e}))}}export default function(n,r){var t={options:Object.assign({},r),columns:[],filters:{},dataListeners:[],filterListeners:[]},u=function(n){return{build:function(n){if(e.isArray(n))return Promise.resolve(D(n));if(!n||"function"!=typeof n.dimension)return Promise.reject(new Error("No Crossfilter data or instance found!"));return Promise.resolve(n)},generateColumns:r,add:function(t){return t=r(t),new Promise((function(e,r){try{e(n.cf.add(t))}catch(e){r(e)}})).then((function(){return e.map(n.dataListeners,(function(e){return function(){return e({added:t})}})).reduce((function(e,n){return e.then(n)}),Promise.resolve(!0))})).then((function(){return Promise.all(e.map(n.filterListeners,(function(e){return e()})))})).then((function(){return n}))},remove:function(r){return new Promise((function(e,t){try{e(n.cf.remove(r))}catch(e){t(e)}})).then((function(){return Promise.all(e.map(n.filterListeners,(function(e){return e()})))})).then((function(){return n}))}};function r(r){return n.options.generatedColumns?e.map(r,(function(r){return e.forEach(n.options.generatedColumns,(function(e,n){r[n]=e(r)})),r})):r}}(t),i=d(t);return n=u.generateColumns(n),u.build(n).then((function(e){return t.cf=e,Object.assign(t,{add:u.add,remove:u.remove,column:H(t),query:Wn(t),filter:i.filter,filterAll:i.filterAll,applyFilters:i.applyFilters,clear:Dn(t),destroy:Yn(t),onDataChange:o,onFilter:a})}));function o(e){return t.dataListeners.push(e),function(){t.dataListeners.splice(t.dataListeners.indexOf(e),1)}}function a(e){return t.filterListeners.push(e),function(){t.filterListeners.splice(t.filterListeners.indexOf(e),1)}}}
//# sourceMappingURL=universe.js.map
