<link rel="import" href="../../polymer/polymer.html">
<dom-module id="home-map">
  <template>
    <style>
    :host {
      display: block;
    }
    </style>
    <svg style="width:3000px; height: 3000px; position:absolute; top:-100000px;">
      <defs>
        <pattern id="pattern-stripe" width="5" height="4" patternUnits="userSpaceOnUse" patternTransform="rotate(-45)">
          <rect width="0.5" height="4" transform="translate(0,0)" fill="white"></rect>
        </pattern>
        <pattern id="pattern-stripe-thick" width="5" height="4" patternUnits="userSpaceOnUse" patternTransform="rotate(-45)">
          <rect width="2.5" height="4" transform="translate(0,0)" fill="white"></rect>
        </pattern>
        <pattern id="pattern-stripe-hor" width="5" height="4" patternUnits="userSpaceOnUse">
          <rect width="0.5" height="4" transform="translate(0,0)" fill="white"></rect>
        </pattern>
        <pattern id="pattern-stripe-inverse" width="5" height="4" patternUnits="userSpaceOnUse" patternTransform="rotate(45)">
          <rect width="0.5" height="4" transform="translate(0,0)" fill="white"></rect>
        </pattern>
        <pattern id="pattern-stripe-thick-inverse" width="5" height="4" patternUnits="userSpaceOnUse" patternTransform="rotate(45)">
          <rect width="2.5" height="4" transform="translate(0,0)" fill="white"></rect>
        </pattern>
        <mask id="mask-stripe">
          <rect x="0" y="0" width="100%" height="100%" fill="url(#pattern-stripe)" />
        </mask>
        <mask id="mask-stripe-thick">
          <rect x="0" y="0" width="100%" height="100%" fill="url(#pattern-stripe-thick)" />
        </mask>
        <mask id="mask-stripe-inverse">
          <rect x="0" y="0" width="100%" height="100%" fill="url(#pattern-stripe-inverse)" />
        </mask>
        <mask id="mask-stripe-thick-inverse">
          <rect x="0" y="0" width="100%" height="100%" fill="url(#pattern-stripe-thick-inverse)" />
        </mask>
        <mask id="mask-stripe-hor">
          <rect x="0" y="0" width="100%" height="100%" fill="url(#pattern-stripe-hor)" />
        </mask>
      </defs>
    </svg>
    <iron-ajax auto url="countryCodes.json" handle-as="json" last-response="{{countryCodes}}"></iron-ajax>
    <iron-ajax auto id="dataLoader" url="worldData.json" on-response="onDataLoaded" handle-as="json" last-response="{{data}}"></iron-ajax>
    <template is="dom-if" if="{{dataLoaded}}">

    	
    </template>
  </template>
  <script>
  (function() {

    /**
     * ## HomeMap
     *
     * `<home-map>` 
     *
     * @memberof MultiChart
     * @customElement
     * @polymer
     * @demo
     **/
    class HomeMap extends Polymer.Element {

      static get is() { return 'home-map'; }

      static get properties() {
        return {
          data: {
            type: Object
          },

          dataLoaded: {
            type: Boolean,
            value: false
          },

          dataLoading: {
            type: Boolean,
            value: false
          },

          universe: {
            type: Object
          },

          projectionType: {
            type: String,
            value: 'geoMercator'
          },

          projectionScale: {
            type: Number,
            value: 300
          },

          filterGeo: {
            type: Function,
            value: function() {
              return function(f) {
                return f.id !== 10;
              };
            }
          },
          countryCodes: {
            type: Object
          },

          forEachGeo: {
            type: Function,
            computed: '_computeForEachGeo(countryCodes)'
          },

          colorRangeMap: {
            type: Array,
            value: ['red', 'orange']
          },

          colorRange: {
            type: Array,
            value: ['#3f51b5']
          },

          dataPartner: {
            type: Array
          },

          dataSector: {
            type: Array
          },

          hoveredPartner: {
            type: String,
            value: '"___null___"'
          },

          hoveredSector: {
            type: String,
            value: '"___null___"'
          },

          countryKeys: {
            type: Array
          },

          /* 
           * `selectedLayer` the selected layer for highlight - `partner`  or `sector`
           */
          selectedLayer: {
            type: String,
            value: 'sector'
          },
        };
      }

      /* 
       * `decorate` we need to place thie function in the markup to make sure we have access to e.model.item highter up in the tree hierarchy 
       */
      decorate(e) {
        console.log('ENRICH', e, e.model.item);
      }

      resetNameValue(e) {
        var dataset = e.currentTarget.dataset;
        var name = dataset.name;
        if (!name) {
          return this._error('setNameValue need a data-name attribute');
        }
        this.set(name, '"___null___"');
        // this.selected = e.target.dataset.select || e.target.parentElement.dataset.select;
      }

      loadData(e) {
        this.$.dataLoader.auto = true;
        this.dataLoading = true;
      }

      onDataLoaded(e) {
        this.dataLoaded = true;
        this.dataLoading = false;
      }

      _computeForEachGeo(countryCodes) {
        var getProperties = function(id) {
          var country = countryCodes.find(function(c) {
            return c['country-code'] * 1 === id * 1;
          });
          if (country) {
            return {
              name: country.name,
              code: country['alpha-3']
            };
          }
        };
        return function(feature) {
          Object.assign(feature.properties, getProperties(feature.id));
        };
      }

      /**
       * `setNameValue` is added so as to set values directly from markup
       */
      setNameValue(e) {
        var dataset = e.currentTarget.dataset;
        var name = dataset.name;
        var value = dataset.value;
        if (!name) {
          return this._error('setNameValue need a data-name attribute');
        }
        this.set(name, value);
        // this.selected = e.target.dataset.select || e.target.parentElement.dataset.select;
      }
    }

    customElements.define(HomeMap.is, HomeMap);

    if (!window.MultiChart) {
      window.MultiChart = {};
    }

    /* 
     * @namespace MultiChart
     */
    window.MultiChart.HomeMap = HomeMap;

  })();
  </script>
</dom-module>