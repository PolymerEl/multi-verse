// webcomponents.org/polymerEl/multi-verse v2.0.0 Copyright 2018 Christophe Geiser
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.universe=n()}(this,function(){"use strict";var e={assign:n,find:function(e,n){return e.find(n)},remove:function(e,n){return e.filter(function(r,t){var u=n(r);return!!u&&(e.splice(t,1),!0)})},isArray:r,isObject:t,isBoolean:function(e){return"boolean"==typeof e},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isFunction:u,get:function(e,n){r(n)&&(n=n.join("."));return n.replace("[",".").replace("]","").split(".").reduce(function(e,n){return e[n]},e)},set:function(e,r,t){"string"==typeof r&&(r=r.replace("[",".").replace("]","").split("."));if(r.length>1){var u=r.shift();n(e[u]="[object Object]"===Object.prototype.toString.call(e[u])?e[u]:{},r,t)}else e[r[0]]=t},map:function(e,n){var r,i;if(u(n)){if(t(e)){for(i in r=[],e)e.hasOwnProperty(i)&&r.push(n(e[i],i,e));return r}return e.map(n)}if(t(e)){for(i in r=[],e)e.hasOwnProperty(i)&&r.push(e[i]);return r}return e.map(function(e){return e[n]})},keys:function(e){return Object.keys(e)},sortBy:function(e,n){if(u(n))return e.sort(function(e,r){return n(e)>n(r)?1:n(e)<n(r)?-1:0})},forEach:i,isUndefined:function(e){return void 0===e},pick:function(e,n){var r={};return i(n,function(n){void 0!==e[n]&&(r[n]=e[n])}),r},xor:function(e,n){var r=[];return i(e,function(e){if(-1===n.indexOf(e))return r.push(e)}),i(n,function(n){if(-1===e.indexOf(n))return r.push(n)}),r},clone:o,isEqual:function e(n,r){if("object"==typeof n&&null!==n&&"object"==typeof r&&null!==r){if(Object.keys(n).length!==Object.keys(r).length)return!1;for(var t in n)return r.hasOwnProperty(t)&&e(n[t],r[t]),!1;return!0}if(n!==r)return!1;return!0},replaceArray:function(e,n){var r=e.length,t=n.length;r>t?e.splice(t,r-t):r<t&&e.push.apply(e,new Array(t-r));return i(e,function(r,t){e[t]=n[t]}),e},uniq:function(e){var n=new Set;return e.filter(function(e){var r=!1;return n.has(e)||(n.add(e),r=!0),r})},flatten:function(e){for(var n=[],r=0;r<e.length;++r)for(var t=e[r],u=0;u<t.length;++u)n.push(t[u]);return n},sort:function(e){for(var n=1;n<e.length;n++){for(var r=e[n],t=n;e[t-1]>r;)e[t]=e[t-1],--t;e[t]=r}return e},values:function(e){var n=[];for(var r in e)e.hasOwnProperty(r)&&n.push(e[r]);return n},recurseObject:function(e,n){return function e(r,t){for(var u in r){var i=o(t);if(i.push(u),"object"==typeof r[u]&&null!==r[u])e(r[u],i);else{if(!r.hasOwnProperty(u))continue;n(r[u],u,i)}}}(e,[]),e}};function n(e){e=e||{};for(var n=1;n<arguments.length;n++)if(arguments[n])for(var r in arguments[n])arguments[n].hasOwnProperty(r)&&(e[r]=arguments[n][r]);return e}function r(e){return Array.isArray(e)}function t(e){return"object"==typeof e&&!r(e)}function u(e){return"function"==typeof e}function i(e,n){if(t(e))for(var u in e)e.hasOwnProperty(u)&&n(e[u],u,e);else if(r(e))return e.forEach(n)}function o(e){return JSON.parse(JSON.stringify(e,function(e,n){return"function"==typeof n?n.toString():n}))}var a="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};if("undefined"!=typeof Uint8Array)var c=function(e){return new Uint8Array(e)},s=function(e,n){if(e.length>=n)return e;var r=new e.constructor(n);return r.set(e),r},f=function(e,n){var r,t;switch(n){case 16:t=e.length,r=new Uint16Array(t);break;case 32:r=function(e){return new Uint32Array(e)}(e.length);break;default:throw new Error("invalid array width!")}return r.set(e),r};function l(e){for(var n=new Array(e),r=-1;++r<e;)n[r]=0;return n}function d(e){this.length=e,this.subarrays=1,this.width=8,this.masks={0:0},this[0]=c(e)}d.prototype.lengthen=function(e){var n,r;for(n=0,r=this.subarrays;n<r;++n)this[n]=s(this[n],e);this.length=e},d.prototype.add=function(){var e,n,r,t,u;for(t=0,u=this.subarrays;t<u;++t)if(r=~(e=this.masks[t])&-~e,!((n=this.width-32*t)>=32)||r)return n<32&&r&1<<n&&(this[t]=f(this[t],n<<=1),this.width=32*t+n),this.masks[t]|=r,{offset:t,one:r};return this[this.subarrays]=c(this.length),this.masks[this.subarrays]=1,this.width+=8,{offset:this.subarrays++,one:1}},d.prototype.copy=function(e,n){var r,t;for(r=0,t=this.subarrays;r<t;++r)this[r][e]=this[r][n]},d.prototype.truncate=function(e){var n,r;for(n=0,r=this.subarrays;n<r;++n){for(var t=this.length-1;t>=e;t--)this[n][t]=0;this[n].length=e}this.length=e},d.prototype.zero=function(e){var n,r;for(n=0,r=this.subarrays;n<r;++n)if(this[n][e])return!1;return!0},d.prototype.zeroExcept=function(e,n,r){var t,u;for(t=0,u=this.subarrays;t<u;++t)if(t===n?this[t][e]&r:this[t][e])return!1;return!0},d.prototype.zeroExceptMask=function(e,n){var r,t;for(r=0,t=this.subarrays;r<t;++r)if(this[r][e]&n[r])return!1;return!0},d.prototype.only=function(e,n,r){var t,u;for(t=0,u=this.subarrays;t<u;++t)if(this[t][e]!=(t===n?r:0))return!1;return!0},d.prototype.onlyExcept=function(e,n,r,t,u){var i,o,a;for(o=0,a=this.subarrays;o<a;++o)if(i=this[o][e],o===n&&(i&=r),i!=(o===t?u:0))return!1;return!0};var v={array8:l,array16:l,array32:l,arrayLengthen:function(e,n){for(var r=e.length;r<n;)e[r++]=0;return e},arrayWiden:function(e,n){if(n>32)throw new Error("invalid array width!");return e},bitarray:d};var h={filterExact:function(e,n){return function(r){var t=r.length;return[e.left(r,n,0,t),e.right(r,n,0,t)]}},filterRange:function(e,n){var r=n[0],t=n[1];return function(n){var u=n.length;return[e.left(n,r,0,u),e.left(n,t,0,u)]}},filterAll:function(e){return[0,e.length]}};var p=function(e){return e};var m=function(){return null};var g=function(){return 0};function y(e){function n(e,n,t){for(var u=t-n,i=1+(u>>>1);--i>0;)r(e,i,u,n);return e}function r(n,r,t,u){for(var i,o=n[--u+r],a=e(o);(i=r<<1)<=t&&(i<t&&e(n[u+i])>e(n[u+i+1])&&i++,!(a<=e(n[u+i])));)n[u+r]=n[u+i],r=i;n[u+r]=o}return n.sort=function(e,n,t){for(var u,i=t-n;--i>0;)u=e[n],e[n]=e[n+i],e[n+i]=u,r(e,1,i,n);return e},n}var b=y(p),x=y;function A(e){var n=b.by(e);return function(r,t,u,i){var o,a,c,s=new Array(i=Math.min(u-t,i));for(a=0;a<i;++a)s[a]=r[t++];if(n(s,0,i),t<u){o=e(s[0]);do{e(c=r[t])>o&&(s[0]=c,o=e(n(s,0,i)[0]))}while(++t<u)}return s}}b.by=x;var k=A(p),O=A;function w(e){function n(n,r,t,u){for(;t<u;){var i=t+u>>>1;r<e(n[i])?u=i:t=i+1}return t}return n.right=n,n.left=function(n,r,t,u){for(;t<u;){var i=t+u>>>1;e(n[i])<r?t=i+1:u=i}return t},n}k.by=O;var L=w(p),_=w;function S(e){return function(n,r,t){for(var u=r+1;u<t;++u){for(var i=u,o=n[u],a=e(o);i>r&&e(n[i-1])>a;--i)n[i]=n[i-1];n[i]=o}return n}}L.by=_;var P=S(p),j=S;P.by=j;var E=function(e,n,r){for(var t=0,u=n.length,i=r?JSON.parse(JSON.stringify(e)):new Array(u);t<u;++t)i[t]=e[n[t]];return i};function $(e){var n=P.by(e);function r(t,u,i){return(i-u<R?n:function(n,t,u){var i,o=(u-t)/6|0,a=t+o,c=u-1-o,s=t+u-1>>1,f=s-o,l=s+o,d=n[a],v=e(d),h=n[f],p=e(h),m=n[s],g=e(m),y=n[l],b=e(y),x=n[c],A=e(x);v>p&&(i=d,d=h,h=i,i=v,v=p,p=i);b>A&&(i=y,y=x,x=i,i=b,b=A,A=i);v>g&&(i=d,d=m,m=i,i=v,v=g,g=i);p>g&&(i=h,h=m,m=i,i=p,p=g,g=i);v>b&&(i=d,d=y,y=i,i=v,v=b,b=i);g>b&&(i=m,m=y,y=i,i=g,g=b,b=i);p>A&&(i=h,h=x,x=i,i=p,p=A,A=i);p>g&&(i=h,h=m,m=i,i=p,p=g,g=i);b>A&&(i=y,y=x,x=i,i=b,b=A,A=i);var k=h,O=p,w=y,L=b;n[a]=d,n[f]=n[t],n[s]=m,n[l]=n[u-1],n[c]=x;var _=t+1,S=u-2,P=O<=L&&O>=L;if(P)for(var j=_;j<=S;++j){var E=n[j],$=e(E);if($<O)j!==_&&(n[j]=n[_],n[_]=E),++_;else if($>O)for(;;){var R=e(n[S]);if(!(R>O)){if(R<O){n[j]=n[_],n[_++]=n[S],n[S--]=E;break}n[j]=n[S],n[S--]=E;break}S--}}else!function(){for(var r=_;r<=S;r++){var t=n[r],u=e(t);if(u<O)r!==_&&(n[r]=n[_],n[_]=t),++_;else if(u>L)for(;;){var i=e(n[S]);if(!(i>L)){i<O?(n[r]=n[_],n[_++]=n[S],n[S--]=t):(n[r]=n[S],n[S--]=t);break}if(--S<r)break}}}();if(n[t]=n[_-1],n[_-1]=k,n[u-1]=n[S+1],n[S+1]=w,r(n,t,_-1),r(n,S+2,u),P)return n;_<a&&S>c&&function(){for(var r,t;(r=e(n[_]))<=O&&r>=O;)++_;for(;(t=e(n[S]))<=L&&t>=L;)--S;for(var u=_;u<=S;u++){var i=n[u],o=e(i);if(o<=O&&o>=O)u!==_&&(n[u]=n[_],n[_]=i),_++;else if(o<=L&&o>=L)for(;;){if(!((t=e(n[S]))<=L&&t>=L)){t<O?(n[u]=n[_],n[_++]=n[S],n[S--]=i):(n[u]=n[S],n[S--]=i);break}if(--S<u)break}}}();return r(n,_,S+1)})(t,u,i)}return r}var R=32,q=$(p),I=$;q.by=I;var C={reduceIncrement:function(e){return e+1},reduceDecrement:function(e){return e-1},reduceAdd:function(e){return function(n,r){return n+ +e(r)}},reduceSubtract:function(e){return function(n,r){return n-e(r)}}},F="crossfilter2@1.4.6",z="crossfilter2@1.4.6",N="sha512-Fdmb6NqdUqreOuQ9qiNvTLOxMFBQRPDeRBBnqM8Zlebdf2i7Bn5hRhE8RlO9YzbGRyYxvYzdDXt6C1muyanolg==",B={},M={type:"version",registry:!0,raw:"crossfilter2@1.4.6",name:"crossfilter2",escapedName:"crossfilter2",rawSpec:"1.4.6",saveSpec:null,fetchSpec:"1.4.6"},U=["/reductio","/universe"],K="https://registry.npmjs.org/crossfilter2/-/crossfilter2-1.4.6.tgz",D="c173f0d75a04344ad226b1f8ae747f0386f98750",T="crossfilter2@1.4.6",J="/home/christophe/Programming/Polymer/2.0-wip/bower_components/multi-verse/node_modules/universe",V={name:"Mike Bostock",url:"http://bost.ocks.org/mike"},Y={url:"https://github.com/crossfilter/crossfilter/issues"},G=[{name:"Jason Davies",url:"http://www.jasondavies.com/"}],W={"lodash.result":"^4.4.0"},Q="Fast multidimensional filtering for coordinated views.",X={browserify:"^13.0.0",d3:"3.5",eslint:"2.10.2","package-json-versionify":"1.0.2",semver:"^5.3.0",sinon:"^4.0.2","uglify-js":"2.4.0",vows:"0.7.0"},Z={env:{browser:!0,node:!0},globals:{Uint8Array:!0,Uint16Array:!0,Uint32Array:!0},extends:"eslint:recommended"},H=["src","index.js","index.d.ts","crossfilter.js","crossfilter.min.js"],ee="https://crossfilter.github.io/crossfilter/",ne=["analytics","visualization","crossfilter"],re=[{name:"Gordon Woodhull",url:"https://github.com/gordonwoodhull"},{name:"Tanner Linsley",url:"https://github.com/tannerlinsley"},{name:"Ethan Jewett",url:"https://github.com/esjewett"}],te={type:"git",url:"git+ssh://git@github.com/crossfilter/crossfilter.git"},ue={benchmark:"node test/benchmark.js",build:"browserify index.js -t package-json-versionify --standalone crossfilter -o crossfilter.js && uglifyjs --compress --mangle --screw-ie8 crossfilter.js -o crossfilter.min.js",clean:"rm -f crossfilter.js crossfilter.min.js",test:"vows --verbose && eslint src/"},ie="./crossfilter.min.js",oe={_from:F,_id:z,_inBundle:!1,_integrity:N,_location:"/crossfilter2",_phantomChildren:B,_requested:M,_requiredBy:U,_resolved:K,_shasum:D,_spec:T,_where:J,author:V,bugs:Y,bundleDependencies:!1,contributors:G,dependencies:W,deprecated:!1,description:Q,devDependencies:X,eslintConfig:Z,files:H,homepage:ee,keywords:ne,license:"Apache-2.0",main:"./index.js",maintainers:re,name:"crossfilter2",repository:te,scripts:ue,types:"./index.d.ts",unpkg:ie,version:"1.4.6"},ae=Object.freeze({_from:F,_id:z,_inBundle:!1,_integrity:N,_location:"/crossfilter2",_phantomChildren:B,_requested:M,_requiredBy:U,_resolved:K,_shasum:D,_spec:T,_where:J,author:V,bugs:Y,bundleDependencies:!1,contributors:G,dependencies:W,deprecated:!1,description:Q,devDependencies:X,eslintConfig:Z,files:H,homepage:ee,keywords:ne,license:"Apache-2.0",main:"./index.js",maintainers:re,name:"crossfilter2",repository:te,scripts:ue,types:"./index.d.ts",unpkg:ie,version:"1.4.6",default:oe}),ce="Expected a function",se="__lodash_hash_undefined__",fe=1/0,le="[object Function]",de="[object GeneratorFunction]",ve="[object Symbol]",he=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,pe=/^\w*$/,me=/^\./,ge=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ye=/\\(\\)?/g,be=/^\[object .+?Constructor\]$/,xe="object"==typeof a&&a&&a.Object===Object&&a,Ae="object"==typeof self&&self&&self.Object===Object&&self,ke=xe||Ae||Function("return this")();var Oe,we=Array.prototype,Le=Function.prototype,_e=Object.prototype,Se=ke["__core-js_shared__"],Pe=(Oe=/[^.]+$/.exec(Se&&Se.keys&&Se.keys.IE_PROTO||""))?"Symbol(src)_1."+Oe:"",je=Le.toString,Ee=_e.hasOwnProperty,$e=_e.toString,Re=RegExp("^"+je.call(Ee).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),qe=ke.Symbol,Ie=we.splice,Ce=Je(ke,"Map"),Fe=Je(Object,"create"),ze=qe?qe.prototype:void 0,Ne=ze?ze.toString:void 0;function Be(e){var n=-1,r=e?e.length:0;for(this.clear();++n<r;){var t=e[n];this.set(t[0],t[1])}}function Me(e){var n=-1,r=e?e.length:0;for(this.clear();++n<r;){var t=e[n];this.set(t[0],t[1])}}function Ue(e){var n=-1,r=e?e.length:0;for(this.clear();++n<r;){var t=e[n];this.set(t[0],t[1])}}function Ke(e,n){for(var r,t,u=e.length;u--;)if((r=e[u][0])===(t=n)||r!=r&&t!=t)return u;return-1}function De(e){return!(!Xe(e)||(n=e,Pe&&Pe in n))&&(Qe(e)||function(e){var n=!1;if(null!=e&&"function"!=typeof e.toString)try{n=!!(e+"")}catch(e){}return n}(e)?Re:be).test(function(e){if(null!=e){try{return je.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(e));var n}function Te(e,n){var r,t,u=e.__data__;return("string"==(t=typeof(r=n))||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==r:null===r)?u["string"==typeof n?"string":"hash"]:u.map}function Je(e,n){var r=function(e,n){return null==e?void 0:e[n]}(e,n);return De(r)?r:void 0}Be.prototype.clear=function(){this.__data__=Fe?Fe(null):{}},Be.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},Be.prototype.get=function(e){var n=this.__data__;if(Fe){var r=n[e];return r===se?void 0:r}return Ee.call(n,e)?n[e]:void 0},Be.prototype.has=function(e){var n=this.__data__;return Fe?void 0!==n[e]:Ee.call(n,e)},Be.prototype.set=function(e,n){return this.__data__[e]=Fe&&void 0===n?se:n,this},Me.prototype.clear=function(){this.__data__=[]},Me.prototype.delete=function(e){var n=this.__data__,r=Ke(n,e);return!(r<0||(r==n.length-1?n.pop():Ie.call(n,r,1),0))},Me.prototype.get=function(e){var n=this.__data__,r=Ke(n,e);return r<0?void 0:n[r][1]},Me.prototype.has=function(e){return Ke(this.__data__,e)>-1},Me.prototype.set=function(e,n){var r=this.__data__,t=Ke(r,e);return t<0?r.push([e,n]):r[t][1]=n,this},Ue.prototype.clear=function(){this.__data__={hash:new Be,map:new(Ce||Me),string:new Be}},Ue.prototype.delete=function(e){return Te(this,e).delete(e)},Ue.prototype.get=function(e){return Te(this,e).get(e)},Ue.prototype.has=function(e){return Te(this,e).has(e)},Ue.prototype.set=function(e,n){return Te(this,e).set(e,n),this};var Ve=Ge(function(e){var n;e=null==(n=e)?"":function(e){if("string"==typeof e)return e;if(Ze(e))return Ne?Ne.call(e):"";var n=e+"";return"0"==n&&1/e==-fe?"-0":n}(n);var r=[];return me.test(e)&&r.push(""),e.replace(ge,function(e,n,t,u){r.push(t?u.replace(ye,"$1"):n||e)}),r});function Ye(e){if("string"==typeof e||Ze(e))return e;var n=e+"";return"0"==n&&1/e==-fe?"-0":n}function Ge(e,n){if("function"!=typeof e||n&&"function"!=typeof n)throw new TypeError(ce);var r=function(){var t=arguments,u=n?n.apply(this,t):t[0],i=r.cache;if(i.has(u))return i.get(u);var o=e.apply(this,t);return r.cache=i.set(u,o),o};return r.cache=new(Ge.Cache||Ue),r}Ge.Cache=Ue;var We=Array.isArray;function Qe(e){var n=Xe(e)?$e.call(e):"";return n==le||n==de}function Xe(e){var n=typeof e;return!!e&&("object"==n||"function"==n)}function Ze(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&$e.call(e)==ve}var He,en,nn=function(e,n,r){var t=-1,u=(n=function(e,n){if(We(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!Ze(e))||pe.test(e)||!he.test(e)||null!=n&&e in Object(n)}(n,e)?[n]:function(e){return We(e)?e:Ve(e)}(n)).length;for(u||(e=void 0,u=1);++t<u;){var i=null==e?void 0:e[Ye(n[t])];void 0===i&&(t=u,i=r),e=Qe(i)?i.call(e):i}return e},rn=(He=ae)&&He.default||He,tn=(function(e,n){var r=-1;function t(e,n){return(n<257?v.array8:n<65537?v.array16:v.array32)(e)}function u(e){for(var n=t(e,e),r=-1;++r<e;)n[r]=r;return n}function i(e){return 8===e?256:16===e?65536:4294967296}n.crossfilter=function(){var e,n={add:d,remove:function(n){for(var u=t(a,a),i=[],s="function"==typeof n,l=0,d=0;l<a;++l)v=l,(s?n(o[v],v):e.zero(v))?(i.push(l),u[l]=r):u[l]=d++;var v;c.forEach(function(e){e(-1,-1,[],i,!0)}),f.forEach(function(e){e(u)});for(var h=0,p=0;h<a;++h)u[h]!==r&&(h!==p&&(e.copy(p,h),o[p]=o[h]),++p);o.length=a=p,e.truncate(p),x("dataRemoved")},dimension:function(n,l){if("string"==typeof n){var d=n;n=function(e){return nn(e,d)}}var y,A,O,w,_,S,P,j,$,R,I,F,z,N,B,M,U={filter:function(e){return null==e?te():Array.isArray(e)?re(e):"function"==typeof e?ue(e):ne(e)},filterExact:ne,filterRange:re,filterFunction:ue,filterAll:te,currentFilter:function(){return N},hasCurrentFilter:function(){return B},top:function(n,r){var t,u=[],i=G,a=0;r&&r>0&&(a=r);for(;--i>=Y&&n>0;)e.zero(t=S[i])&&(a>0?--a:(u.push(o[t]),--n));if(l)for(i=0;i<K.length&&n>0;i++)e.zero(t=K[i])&&(a>0?--a:(u.push(o[t]),--n));return u},bottom:function(n,r){var t,u,i=[],a=0;r&&r>0&&(a=r);if(l)for(t=0;t<K.length&&n>0;t++)e.zero(u=K[t])&&(a>0?--a:(i.push(o[u]),--n));t=Y;for(;t<G&&n>0;)e.zero(u=S[t])&&(a>0?--a:(i.push(o[u]),--n)),t++;return i},group:oe,groupAll:function(){var e=oe(m),n=e.all;return delete e.all,delete e.top,delete e.order,delete e.orderNatural,delete e.size,e.value=function(){return n()[0].value},e},dispose:ae,remove:ae,accessor:n,id:function(){return w}},K=[],D=q.by(function(e){return P[e]}),T=h.filterAll,J=[],V=[],Y=0,G=0,W=0;s.unshift(X),s.push(Z),f.push(H);var Q=e.add();function X(r,i,o){if(l){W=0,B=0,M=[];for(var c=0;c<r.length;c++)for(B=0,M=n(r[c]);B<M.length;B++)W++;P=[],R=u(r.length),F=t(W,1);for(var s=u(W),f=0,d=0;d<r.length;d++)if((M=n(r[d])).length)for(R[d]=M.length,B=0;B<M.length;B++)P.push(M[B]),s[f]=d,f++;else R[d]=0,K.push(d+i);var h=D(u(W),0,W);P=E(P,h),j=E(s,h)}else P=r.map(n),j=D(u(o),0,o),P=E(P,j);l&&(o=W);var p=T(P),m=p[0],g=p[1];if(z)for(var b=0;b<o;++b)z(P[b],b)||(e[O][j[b]+i]|=y,l&&(F[b]=1));else{for(var x=0;x<m;++x)e[O][j[x]+i]|=y,l&&(F[x]=1);for(var A=g;A<o;++A)e[O][j[A]+i]|=y,l&&(F[A]=1)}if(!i)return _=P,S=j,$=R,I=F,Y=m,void(G=g);var k,w=_,L=S,q=I,C=0;if(c=0,l&&(k=i,i=w.length,o=W),_=l?new Array(i+o):new Array(a),S=l?new Array(i+o):t(a,a),l&&(I=t(i+o,1)),l){var N=$.length;$=v.arrayLengthen($,a);for(var B=0;B+N<a;B++)$[B+N]=R[B]}for(var U=0;c<i&&C<o;++U)w[c]<P[C]?(_[U]=w[c],l&&(I[U]=q[c]),S[U]=L[c++]):(_[U]=P[C],l&&(I[U]=F[C]),S[U]=j[C++]+(l?k:i));for(;c<i;++c,++U)_[U]=w[c],l&&(I[U]=q[c]),S[U]=L[c];for(;C<o;++C,++U)_[U]=P[C],l&&(I[U]=F[C]),S[U]=j[C]+(l?k:i);p=T(_),Y=p[0],G=p[1]}function Z(e,n,r){J.forEach(function(e){e(P,j,n,r)}),P=j=null}function H(e){if(l){for(var n=0,t=0;n<K.length;n++)e[K[n]]!==r&&(K[t]=e[K[n]],t++);for(K.length=t,n=0,t=0;n<a;n++)e[n]!==r&&(t!==n&&($[t]=$[n]),t++);$.length=t}for(var u,i=_.length,o=0,c=0;o<i;++o)u=S[o],e[u]!==r&&(o!==c&&(_[c]=_[o]),S[c]=e[u],l&&(I[c]=I[o]),++c);for(_.length=c,l&&(I.length=c);c<i;)S[c++]=0;var s=T(_);Y=s[0],G=s[1]}function ee(n){var r=n[0],t=n[1];if(z)return z=null,ie(function(e,n){return r<=n&&n<t},0===n[0]&&n[1]===_.length),Y=r,G=t,U;var u,i,o,a=[],s=[],f=[],d=[];if(r<Y)for(u=r,i=Math.min(Y,t);u<i;++u)a.push(S[u]),f.push(u);else if(r>Y)for(u=Y,i=Math.min(r,G);u<i;++u)s.push(S[u]),d.push(u);if(t>G)for(u=Math.max(r,G),i=t;u<i;++u)a.push(S[u]),f.push(u);else if(t<G)for(u=Math.max(Y,t),i=G;u<i;++u)s.push(S[u]),d.push(u);if(l){var v=[],h=[];for(u=0;u<a.length;u++)$[a[u]]++,I[f[u]]=0,1===$[a[u]]&&(e[O][a[u]]^=y,v.push(a[u]));for(u=0;u<s.length;u++)$[s[u]]--,I[d[u]]=1,0===$[s[u]]&&(e[O][s[u]]^=y,h.push(s[u]));if(a=v,s=h,0===n[0]&&n[1]===_.length)for(u=0;u<K.length;u++)e[O][o=K[u]]&y&&(e[O][o]^=y,a.push(o));else for(u=0;u<K.length;u++)e[O][o=K[u]]&y||(e[O][o]^=y,s.push(o))}else{for(u=0;u<a.length;u++)e[O][a[u]]^=y;for(u=0;u<s.length;u++)e[O][s[u]]^=y}return Y=r,G=t,c.forEach(function(e){e(y,O,a,s)}),x("filtered"),U}function ne(e){return N=e,B=!0,ee((T=h.filterExact(L,e))(_))}function re(e){return N=e,B=!0,ee((T=h.filterRange(L,e))(_))}function te(){return N=void 0,B=!1,ee((T=h.filterAll)(_))}function ue(e){N=e,B=!0,z=e,T=h.filterAll,ie(e,!1);var n=T(_);return Y=n[0],G=n[1],U}function ie(n,r){var t,u,i,o=[],a=[],s=[],f=[],d=_.length;if(!l)for(t=0;t<d;++t)!(e[O][u=S[t]]&y)^!!(i=n(_[t],t))&&(i?o.push(u):a.push(u));if(l)for(t=0;t<d;++t)n(_[t],t)?(o.push(S[t]),s.push(t)):(a.push(S[t]),f.push(t));if(l){var v=[],h=[];for(t=0;t<o.length;t++)1===I[s[t]]&&($[o[t]]++,I[s[t]]=0,1===$[o[t]]&&(e[O][o[t]]^=y,v.push(o[t])));for(t=0;t<a.length;t++)0===I[f[t]]&&($[a[t]]--,I[f[t]]=1,0===$[a[t]]&&(e[O][a[t]]^=y,h.push(a[t])));if(o=v,a=h,r)for(t=0;t<K.length;t++)e[O][u=K[t]]&y&&(e[O][u]^=y,o.push(u));else for(t=0;t<K.length;t++)e[O][u=K[t]]&y||(e[O][u]^=y,a.push(u))}else{for(t=0;t<o.length;t++)e[O][o[t]]&y&&(e[O][o[t]]&=A);for(t=0;t<a.length;t++)e[O][a[t]]&y||(e[O][a[t]]|=y)}c.forEach(function(e){e(y,O,o,a)}),x("filtered")}function oe(n){var u={top:function(e){var n=h(T(),0,s.length,e);return x.sort(n,0,n.length)},all:T,reduce:Y,reduceCount:G,reduceSum:function(e){return Y(C.reduceAdd(e),C.reduceSubtract(e),g)},order:W,orderNatural:function(){return W(p)},size:function(){return R},dispose:Q,remove:Q};V.push(u);var s,d,h,x,w,L,P,j,E=8,$=i(E),R=0,q=m,I=m,F=!0,z=n===m;function N(r,u,f,h){l&&(j=f,f=_.length-r.length,h=r.length);var p,g,y,b,x,k,S=s,C=l?[]:t(R,$),N=w,B=L,T=P,J=R,V=0,Y=0;for(F&&(N=T=m),F&&(B=T=m),s=new Array(R),R=0,d=l?J?d:[]:J>1?v.arrayLengthen(d,a):t(a,$),J&&(y=(g=S[0]).key);Y<h&&!((b=n(r[Y]))>=b);)++Y;for(;Y<h;){for(g&&y<=b?(x=g,k=y,C[V]=R,(g=S[++V])&&(y=g.key)):(x={key:b,value:T()},k=b),s[R]=x;b<=k&&(p=u[Y]+(l?j:f),l?d[p]?d[p].push(R):d[p]=[R]:d[p]=R,x.value=N(x.value,o[p],!0),e.zeroExcept(p,O,A)||(x.value=B(x.value,o[p],!1)),!(++Y>=h));)b=n(r[Y]);W()}for(;V<J;)s[C[V]=R]=S[V++],W();if(l)for(var G=0;G<a;G++)d[G]||(d[G]=[]);if(R>V)if(l)for(V=0;V<j;++V)for(G=0;G<d[V].length;G++)d[V][G]=C[d[V][G]];else for(V=0;V<f;++V)d[V]=C[d[V]];function W(){l?R++:++R===$&&(C=v.arrayWiden(C,E<<=1),d=v.arrayWiden(d,E),$=i(E))}p=c.indexOf(q),R>1||l?(q=M,I=K):(!R&&z&&(R=1,s=[{key:null,value:T()}]),1===R?(q=U,I=D):(q=m,I=m),d=null),c[p]=q}function B(e){if(R>1||l){var n,u,i,o=R,f=s,v=t(o,o);if(l){for(n=0,i=0;n<a;++n)if(e[n]!==r){for(d[i]=d[n],u=0;u<d[i].length;u++)v[d[i][u]]=1;++i}}else for(n=0,i=0;n<a;++n)e[n]!==r&&(v[d[i]=d[n]]=1,++i);for(s=[],R=0,n=0;n<o;++n)v[n]&&(v[n]=R++,s.push(f[n]));if(R>1||l)if(l)for(n=0;n<i;++n)for(u=0;u<d[n].length;++u)d[n][u]=v[d[n][u]];else for(n=0;n<i;++n)d[n]=v[d[n]];else d=null;c[c.indexOf(q)]=R>1||l?(I=K,q=M):1===R?(I=D,q=U):I=q=m}else if(1===R){if(z)return;for(var h=0;h<a;++h)if(e[h]!==r)return;s=[],R=0,c[c.indexOf(q)]=q=I=m}}function M(n,r,t,u,i){var a,c,f,v,h;if(!(n===y&&r===O||F))if(l){for(a=0,v=t.length;a<v;++a)if(e.zeroExcept(f=t[a],O,A))for(c=0;c<d[f].length;c++)(h=s[d[f][c]]).value=w(h.value,o[f],!1,c);for(a=0,v=u.length;a<v;++a)if(e.onlyExcept(f=u[a],O,A,r,n))for(c=0;c<d[f].length;c++)(h=s[d[f][c]]).value=L(h.value,o[f],i,c)}else{for(a=0,v=t.length;a<v;++a)e.zeroExcept(f=t[a],O,A)&&((h=s[d[f]]).value=w(h.value,o[f],!1));for(a=0,v=u.length;a<v;++a)e.onlyExcept(f=u[a],O,A,r,n)&&((h=s[d[f]]).value=L(h.value,o[f],i))}}function U(n,r,t,u,i){if(!(n===y&&r===O||F)){var a,c,f,l=s[0];for(a=0,f=t.length;a<f;++a)e.zeroExcept(c=t[a],O,A)&&(l.value=w(l.value,o[c],!1));for(a=0,f=u.length;a<f;++a)e.onlyExcept(c=u[a],O,A,r,n)&&(l.value=L(l.value,o[c],i))}}function K(){var n,r,t;for(n=0;n<R;++n)s[n].value=P();if(l){for(n=0;n<a;++n)for(r=0;r<d[n].length;r++)(t=s[d[n][r]]).value=w(t.value,o[n],!0,r);for(n=0;n<a;++n)if(!e.zeroExcept(n,O,A))for(r=0;r<d[n].length;r++)(t=s[d[n][r]]).value=L(t.value,o[n],!1,r)}else{for(n=0;n<a;++n)(t=s[d[n]]).value=w(t.value,o[n],!0);for(n=0;n<a;++n)e.zeroExcept(n,O,A)||((t=s[d[n]]).value=L(t.value,o[n],!1))}}function D(){var n,r=s[0];for(r.value=P(),n=0;n<a;++n)r.value=w(r.value,o[n],!0);for(n=0;n<a;++n)e.zeroExcept(n,O,A)||(r.value=L(r.value,o[n],!1))}function T(){return F&&(I(),F=!1),s}function Y(e,n,r){return w=e,L=n,P=r,F=!0,u}function G(){return Y(C.reduceIncrement,C.reduceDecrement,g)}function W(e){function n(n){return e(n.value)}return h=k.by(n),x=b.by(n),u}function Q(){var e=c.indexOf(q);return e>=0&&c.splice(e,1),(e=J.indexOf(N))>=0&&J.splice(e,1),(e=f.indexOf(B))>=0&&f.splice(e,1),(e=V.indexOf(u))>=0&&V.splice(e,1),u}return arguments.length<1&&(n=p),c.push(q),J.push(N),f.push(B),N(_,S,0,a),G().orderNatural()}function ae(){V.forEach(function(e){e.dispose()});var n=s.indexOf(X);return n>=0&&s.splice(n,1),(n=s.indexOf(Z))>=0&&s.splice(n,1),(n=f.indexOf(H))>=0&&f.splice(n,1),e.masks[O]&=A,te()}return O=Q.offset,y=Q.one,A=~y,w=O<<7|Math.log(y)/Math.log(2),X(o,0,a),Z(o,0,a),U},groupAll:function(){var n,r,t,u,i={reduce:v,reduceCount:h,reduceSum:function(e){return v(C.reduceAdd(e),C.reduceSubtract(e),g)},value:function(){f&&(function(){var i;for(n=u(),i=0;i<a;++i)n=r(n,o[i],!0),e.zero(i)||(n=t(n,o[i],!1))}(),f=!1);return n},dispose:p,remove:p},f=!0;function l(u,i){var c;if(!f)for(c=i;c<a;++c)n=r(n,o[c],!0),e.zero(c)||(n=t(n,o[c],!1))}function d(u,i,a,c,s){var l,d,v;if(!f){for(l=0,v=a.length;l<v;++l)e.zero(d=a[l])&&(n=r(n,o[d],s));for(l=0,v=c.length;l<v;++l)e.only(d=c[l],i,u)&&(n=t(n,o[d],s))}}function v(e,n,o){return r=e,t=n,u=o,f=!0,i}function h(){return v(C.reduceIncrement,C.reduceDecrement,g)}function p(){var e=c.indexOf(d);return e>=0&&c.splice(e,1),(e=s.indexOf(l))>=0&&s.splice(e,1),i}return c.push(d),s.push(l),l(o,0),h()},size:function(){return a},all:function(){return o},allFiltered:function(n){var r=[],t=0,u=y(n||[]);for(t=0;t<a;t++)e.zeroExceptMask(t,u)&&r.push(o[t]);return r},onChange:function(e){if("function"!=typeof e)return void console.warn("onChange callback parameter must be a function!");return l.push(e),function(){l.splice(l.indexOf(e),1)}},isElementFiltered:function(n,r){var t=y(r||[]);return e.zeroExceptMask(n,t)}},o=[],a=0,c=[],s=[],f=[],l=[];function d(r){var t=a,u=r.length;return u&&(o=o.concat(r),e.lengthen(a+=u),s.forEach(function(e){e(r,t,u)}),x("dataAdded")),n}function y(n){var r,t,u,i,o=Array(e.subarrays);for(r=0;r<e.subarrays;r++)o[r]=-1;for(t=0,u=n.length;t<u;t++)i=n[t].id(),o[i>>7]&=~(1<<(63&i));return o}function x(e){for(var n=0;n<l.length;n++)l[n](e)}return e=new v.bitarray(0),arguments.length?d(arguments[0]):n},n.crossfilter.heap=b,n.crossfilter.heapselect=k,n.crossfilter.bisect=L,n.crossfilter.insertionsort=P,n.crossfilter.permute=E,n.crossfilter.quicksort=q,n.crossfilter.version=rn.version}(en={exports:{}},en.exports),en.exports),un=(tn.crossfilter,tn.crossfilter),on=function(n){return{build:function(n){if(e.isArray(n))return Promise.resolve(un(n));if(!n||"function"!=typeof n.dimension)return Promise.reject(new Error("No Crossfilter data or instance found!"));return Promise.resolve(n)},generateColumns:r,add:function(t){return t=r(t),new Promise(function(e,r){try{e(n.cf.add(t))}catch(e){r(e)}}).then(function(){return e.map(n.dataListeners,function(e){return function(){return e({added:t})}}).reduce(function(e,n){return e.then(n)},Promise.resolve(!0))}).then(function(){return Promise.all(e.map(n.filterListeners,function(e){return e()}))}).then(function(){return n})},remove:function(r){return new Promise(function(e,t){try{e(n.cf.remove(r))}catch(e){t(e)}}).then(function(){return Promise.all(e.map(n.filterListeners,function(e){return e()}))}).then(function(){return n})}};function r(r){return n.options.generatedColumns?e.map(r,function(r){return e.forEach(n.options.generatedColumns,function(e,n){r[n]=e(r)}),r}):r}},an={$field:function(e,n){return e[n]},$and:function(e,n){n=n(e);for(var r=0;r<n.length;r++)if(!n[r])return!1;return!0},$or:function(e,n){n=n(e);for(var r=0;r<n.length;r++)if(n[r])return!0;return!1},$not:function(e,n){n=n(e);for(var r=0;r<n.length;r++)if(n[r])return!1;return!0},$eq:function(e,n){return e===n()},$gt:function(e,n){return e>n()},$gte:function(e,n){return e>=n()},$lt:function(e,n){return e<n()},$lte:function(e,n){return e<=n()},$ne:function(e,n){return e!==n()},$type:function(e,n){return typeof e===n()},$in:function(e,n){return e.indexOf(n())>-1},$nin:function(e,n){return-1===e.indexOf(n())},$contains:function(e,n){return n().indexOf(e)>-1},$excludes:function(e,n){return-1===n().indexOf(e)},$size:function(e,n){return e.length===n()}};var cn={$sum:function(e){return e.reduce(function(e,n){return e+n},0)},$avg:function(e){return e.reduce(function(e,n){return e+n},0)/e.length},$max:function(e){return Math.max.apply(null,e)},$min:function(e){return Math.min.apply(null,e)},$count:function(e){return e.length},$first:function(e){return e[0]},$last:function(e){return e[e.length-1]},$get:hn,$nth:hn,$nthLast:function(e,n){return e[e.length-n]},$nthPct:function(e,n){return e[Math.round(e.length*(n/100))]},$map:function(e,n){return e.map(function(e){return e[n]})}},sn={makeValueAccessor:function(n){if("string"==typeof n){if(!dn(n))return n;n=vn(n)}if("number"==typeof n)return n;if(e.isObject(n))return r=fn(n),function(e){return r(e)};var r},aggregators:cn,extractKeyValOrArray:ln,parseAggregatorParams:function(e){var n=[],r=e.indexOf("("),t=e.indexOf(")"),u=r>-1?e.substring(0,r):e;if(!cn[u])return!1;r>-1&&t>-1&&t>r&&(n=e.substring(r+1,t).split(","));return{aggregator:cn[u],params:n}}};function fn(n){if(n=e.isObject(n)?ln(n):n,e.isString(n))return dn(n)?fn(vn(n)):function(e){return e[n]};if(e.isArray(n)){var r=e.map(n,fn);return function(e){return r.map(function(n){return n(e)})}}if(n.key){if(cn[n.key]){var t=fn(n.value);return function(e){return cn[n.key](t(e))}}console.error("Could not find aggregration method",n)}return[]}function ln(e){var n,r=[];for(var t in e)if({}.hasOwnProperty.call(e,t)){n={key:t,value:e[t]};var u={};u[t]=e[t],r.push(u)}return r.length>1?r:n}function dn(e){return["$","("].indexOf(e.charAt(0))>-1}function vn(e){var n=/\((.+)\)/g,r=/(?:\([^\(\)]*\))|(,)/g;return JSON.parse("{"+function e(t){t=t.replace(" ","");return'"'+t.replace(n,function(n,t){if(r.test(t))return"$"===t.charAt(0)?'":{"'+t.replace(r,function(n){return","===n?',"':e(n).trim()})+"}":':["'+t.replace(r,function(){return'","'})+'"]'})}(e)+"}")}function hn(e,n){return e[n]}var pn=function(n){return{filter:function(i,o,a,c){return r(i).then(function(r){var i=e.assign({},n.filters),s=r.key;return"array"===r.complex&&(s=JSON.stringify(r.key)),"function"===r.complex&&(s=r.key.toString()),i[s]=t(o,a,c),u(i)})},filterAll:function(i){if(!i)return n.columns.forEach(function(e){e.dimension.filterAll()}),u({});var o=e.assign({},n.filters),a=e.map(i,function(e){return r(e.column).then(function(n){var r=n.complex?JSON.stringify(n.key):n.key;o[r]=t(e.value,e.isRange,e.replace)})});return Promise.all(a).then(function(){return u(o)})},applyFilters:u,makeFunction:o,scanForDynamicFilters:function(n){var r=[];return function n(t){e.forEach(t,function(t,u){var o=i(t,u);o&&r.push(o),e.isString(t)&&(o=i(null,t))&&r.push(o),e.isObject(t)&&n(t)})}(n.filter),r}};function r(e){var r=n.column.find(e);return new Promise(function(t,u){try{if(!r)return t(n.column({key:e,temporary:!0}).then(function(){return n.column.find(e)}));t(r)}catch(e){u(e)}})}function t(n,r,t){return!e.isUndefined(n)&&(e.isFunction(n)?{value:n,function:n,replace:!0,type:"function"}:e.isObject(n)?{value:n,function:o(n),replace:!0,type:"function"}:e.isArray(n)?{value:n,replace:r||t,type:r?"range":"inclusive"}:{value:n,replace:t,type:"exact"})}function u(r){var t=e.map(r,function(t,u){var i,o=n.filters[u];return t===o?Promise.resolve():(i="["===u.charAt(0)?n.column.find(JSON.parse(u)):n.column.find(u),t&&o&&!t.replace&&(r[u]=t=function(n,r){if("exact"===n.type&&"inclusive"===r.type)n.value=e.xor([n.value],r.value);else if("inclusive"===n.type&&"exact"===r.type)n.value=e.xor(n.value,[r.value]);else if("inclusive"===n.type&&"inclusive"===r.type)n.value=e.xor(n.value,r.value);else if("exact"===n.type&&"exact"===r.type){if(n.value===r.value)return!1;n.value=[n.value,r.value]}n.value.length?1===n.value.length?(n.type="exact",n.value=n.value[0]):n.type="inclusive":n=!1;return n}(t,o)),t?"exact"===t.type?Promise.resolve(i.dimension.filterExact(t.value)):"range"===t.type?Promise.resolve(i.dimension.filterRange(t.value)):"inclusive"===t.type?Promise.resolve(i.dimension.filterFunction(function(e){return t.value.indexOf(e)>-1})):"function"===t.type?Promise.resolve(i.dimension.filterFunction(t.function)):Promise.resolve(i.dimension.filterAll()):Promise.resolve(i.dimension.filterAll()))});return Promise.all(t).then(function(){n.filters=r;var t=[];return e.forEach(n.filters,function(e,r){e||(t.push({key:r,val:e}),delete n.filters[r])}),Promise.all(e.map(t,function(e){var r=n.column.find("["===e.key.charAt(0)?JSON.parse(e.key):e.key);if(r.temporary&&!r.dynamicReference)return n.clear(r.key)}))}).then(function(){return Promise.all(e.map(n.filterListeners,function(e){return e()}))}).then(function(){return n})}function i(n,r){return"$data"===r||(r&&"$column"===r?e.isString(n)?n:(console.warn('The value for filter "$column" must be a valid column key',n),!1):void 0)}function o(r,t){var u;if(e.isString(r)&&i(null,r)){var a=n.cf.all();return function(){return a}}return e.isString(r)||e.isNumber(r)||e.isBoolean(r)?function(e){return void 0===e?r:an.$eq(e,function(){return r})}:e.isArray(r)?(u=e.map(r,function(e){return o(e,t)}),function(e){return u.map(function(n){return n(e)})}):e.isObject(r)?(u=e.map(r,function(e,r){var u=o(e,t),a=i(e,r);if(a){var c=n.column.find(a).values;return function(){return c}}if(an[r])return function(e){return an[r](e,u)};var s=sn.parseAggregatorParams(r);return s?(u=o(e,t=!0),function(){return s.aggregator.apply(null,[u()].concat(s.params))}):function(e){return e=e[r],u(e,u)}}),t?1===u.length?function(e){return u[0](e)}:function(n){return e.map(u,function(e){return e(n)})}:function(n){return an.$and(n,function(n){return e.map(u,function(e){return e(n)})})}):(console.log("no expression found for ",r),!1)}},mn=function(n){var r=function(n){return{make:function(e,t,u){var i=r(e,u);return Promise.resolve(n.cf.dimension(i,"array"===t))},makeAccessor:r};function r(n,r){var t;if("string"===r)t=function(r){return e.get(r,n)};else if("function"===r)t=n;else if("array"===r){var u=e.map(n,function(e){return"d['"+e+"']"});t=new Function("d",String("return "+JSON.stringify(u).replace(/"/g,"")))}else t=!0===n?function(e,n){return n}:function(e){return e[n]};return t}}(n),t=function(r){e.isUndefined(r)&&(r=!0);e.isArray(r)||(r=[r]);return Promise.all(e.map(r,i)).then(function(){return n})};return t.find=u,t;function u(r){return e.find(n.columns,function(n){return e.isArray(r)?!e.xor(n.key,r).length:n.key===r})}function i(t){var i=e.isObject(t)?t:{key:t},o=u(i.key);return o?(o.temporary=!1,o.dynamicReference&&(o.dynamicReference=!1),o.promise.then(function(){return n})):(i.queries=[],n.columns.push(i),i.promise=new Promise(function(e,r){try{e(n.cf.all())}catch(e){r(e)}}).then(function(n){var t,u;if(e.isFunction(i.key))i.complex="function",t=i.key(n[0]);else if(e.isString(i.key)&&(i.key.indexOf(".")>-1||i.key.indexOf("[")>-1))i.complex="string",t=e.get(n[0],i.key);else if(e.isArray(i.key)){if(i.complex="array",(t=e.values(e.pick(n[0],i.key))).length!==i.key.length)throw new Error("Column key does not exist in data!",i.key)}else t=n[0][i.key];if(!i.complex&&!0!==i.key&&void 0===t)throw new Error("Column key does not exist in data!",i.key);return!0===i.key?i.type="all":i.complex?i.type="complex":i.array?i.type="array":i.type=(u=t,e.isNumber(u)?"number":e.isBoolean(u)?"bool":e.isArray(u)?"array":e.isObject(u)?"object":"string"),r.make(i.key,i.type,i.complex)}).then(function(t){i.dimension=t,i.filterCount=0;var u=n.onDataChange(o);return i.removeListeners=[u],o();function o(n){if(!0===i.key)return Promise.resolve();var t=r.makeAccessor(i.key,i.complex);return i.values=i.values||[],new Promise(function(e,r){try{n&&n.added?e(n.added):e(i.dimension.bottom(1/0))}catch(e){r(e)}}).then(function(n){var r;r="string"===i.complex||"function"===i.complex?e.map(n,t):"array"===i.type?e.flatten(e.map(n,t)):e.map(n,t),i.values=e.uniq(i.values.concat(r))})}}),i.promise.then(function(){return n}))}},gn={add:function(e,n,r){return function(t,u,i){return e(u,i)?n&&n(t,u,i):r&&r(t,u,i),t}},remove:function(e,n,r){return function(t,u,i){return e(u,i)?n&&n(t,u,i):r&&r(t,u,i),t}}},yn={add:function(e,n,r){return function(t,u,i){return e&&e(t,u,i),n(t)[r]++,t}},remove:function(e,n,r){return function(t,u,i){return e&&e(t,u,i),n(t)[r]--,t}},initial:function(e,n,r){return function(t){return e&&(t=e(t)),n(t)[r]=0,t}}},bn={add:function(e,n,r){return function(t,u,i){return n&&n(t,u,i),r(t).sum=r(t).sum+e(u),t}},remove:function(e,n,r){return function(t,u,i){return n&&n(t,u,i),r(t).sum=r(t).sum-e(u),t}},initial:function(e,n){return function(r){return r=e(r),n(r).sum=0,r}}},xn={add:function(e,n,r){return function(e,t,u){return n&&n(e,t,u),r(e).count>0?r(e).avg=r(e).sum/r(e).count:r(e).avg=0,e}},remove:function(e,n,r){return function(e,t,u){return n&&n(e,t,u),r(e).count>0?r(e).avg=r(e).sum/r(e).count:r(e).avg=0,e}},initial:function(e,n){return function(r){return r=e(r),n(r).avg=0,r}}},An={add:function(e,n){var r;return function(t,u,i){return e&&e(t,u,i),r=Math.floor(n(t).valueList.length/2),n(t).valueList.length%2?n(t).median=n(t).valueList[r]:n(t).median=(n(t).valueList[r-1]+n(t).valueList[r])/2,t}},remove:function(e,n){var r;return function(t,u,i){return e&&e(t,u,i),r=Math.floor(n(t).valueList.length/2),0===n(t).valueList.length?(n(t).median=void 0,t):(1===n(t).valueList.length||n(t).valueList.length%2?n(t).median=n(t).valueList[r]:n(t).median=(n(t).valueList[r-1]+n(t).valueList[r])/2,t)}},initial:function(e,n){return function(r){return r=e(r),n(r).median=void 0,r}}},kn={add:function(e,n){return function(r,t,u){return e&&e(r,t,u),n(r).min=n(r).valueList[0],r}},remove:function(e,n){return function(r,t,u){return e&&e(r,t,u),0===n(r).valueList.length?(n(r).min=void 0,r):(n(r).min=n(r).valueList[0],r)}},initial:function(e,n){return function(r){return r=e(r),n(r).min=void 0,r}}},On={add:function(e,n){return function(r,t,u){return e&&e(r,t,u),n(r).max=n(r).valueList[n(r).valueList.length-1],r}},remove:function(e,n){return function(r,t,u){return e&&e(r,t,u),0===n(r).valueList.length?(n(r).max=void 0,r):(n(r).max=n(r).valueList[n(r).valueList.length-1],r)}},initial:function(e,n){return function(r){return r=e(r),n(r).max=void 0,r}}},wn={add:function(e,n,r){var t,u;return function(i,o,a){return n&&n(i,o,a),t=r(i).bisect(r(i).values,e(o),0,r(i).values.length),(u=r(i).values[t])&&u[0]===e(o)?u[1]++:r(i).values.splice(t,0,[e(o),1]),i}},remove:function(e,n,r){var t;return function(u,i,o){return n&&n(u,i,o),t=r(u).bisect(r(u).values,e(i),0,r(u).values.length),r(u).values[t][1]--,u}},initial:function(e,n){return function(r){return r=e(r),n(r).values=[],n(r).bisect=un.bisect.by(function(e){return e[0]}).left,r}}},Ln={add:function(e,n,r){var t,u=un.bisect.by(function(e){return e}).left;return function(i,o,a){return n&&n(i,o,a),t=u(r(i).valueList,e(o),0,r(i).valueList.length),r(i).valueList.splice(t,0,e(o)),i}},remove:function(e,n,r){var t,u=un.bisect.by(function(e){return e}).left;return function(i,o,a){return n&&n(i,o,a),t=u(r(i).valueList,e(o),0,r(i).valueList.length),r(i).valueList.splice(t,1),i}},initial:function(e,n){return function(r){return r=e(r),n(r).valueList=[],r}}},_n={add:function(e,n,r){var t,u;return function(i,o,a){return n&&n(i,o,a),t=r(i).bisect(r(i).values,e(o),0,r(i).values.length),(u=r(i).values[t])&&u[0]===e(o)&&0!==u[1]||r(i).exceptionCount++,i}},remove:function(e,n,r){var t,u;return function(i,o,a){return n&&n(i,o,a),t=r(i).bisect(r(i).values,e(o),0,r(i).values.length),(u=r(i).values[t])&&u[0]===e(o)&&1===u[1]&&r(i).exceptionCount--,i}},initial:function(e,n){return function(r){return r=e(r),n(r).exceptionCount=0,r}}},Sn={add:function(e,n,r,t){var u,i;return function(o,a,c){return r&&r(o,a,c),u=t(o).bisect(t(o).values,e(a),0,t(o).values.length),(i=t(o).values[u])&&i[0]===e(a)&&0!==i[1]||(t(o).exceptionSum=t(o).exceptionSum+n(a)),o}},remove:function(e,n,r,t){var u,i;return function(o,a,c){return r&&r(o,a,c),u=t(o).bisect(t(o).values,e(a),0,t(o).values.length),(i=t(o).values[u])&&i[0]===e(a)&&1===i[1]&&(t(o).exceptionSum=t(o).exceptionSum-n(a)),o}},initial:function(e,n){return function(r){return r=e(r),n(r).exceptionSum=0,r}}},Pn={add:function(e,n,r){var t,u=un.bisect.by(function(e){return e}).left,i=un.bisect.by(function(e){return e.x}).right;return function(o,a,c){return n&&n(o,a,c),(t=r(o).histogram[i(r(o).histogram,e(a),0,r(o).histogram.length)-1]).y++,t.splice(u(t,e(a),0,t.length),0,e(a)),o}},remove:function(e,n,r){var t,u=un.bisect.by(function(e){return e}).left,i=un.bisect.by(function(e){return e.x}).right;return function(o,a,c){return n&&n(o,a,c),(t=r(o).histogram[i(r(o).histogram,e(a),0,r(o).histogram.length)-1]).y--,t.splice(u(t,e(a),0,t.length),1),o}},initial:function(e,n,r){return function(t){t=n(t),r(t).histogram=[];for(var u=[],i=1;i<e.length;i++)(u=[]).x=e[i-1],u.dx=e[i]-e[i-1],u.y=0,r(t).histogram.push(u);return t}}},jn={add:function(e,n,r){return function(t,u,i){return n&&n(t,u,i),r(t).sumOfSq=r(t).sumOfSq+e(u)*e(u),t}},remove:function(e,n,r){return function(t,u,i){return n&&n(t,u,i),r(t).sumOfSq=r(t).sumOfSq-e(u)*e(u),t}},initial:function(e,n){return function(r){return r=e(r),n(r).sumOfSq=0,r}}},En={add:function(e,n){return function(r,t,u){if(e&&e(r,t,u),n(r).count>0){n(r).std=0;var i=n(r).sumOfSq-n(r).sum*n(r).sum/n(r).count;i>0&&(n(r).std=Math.sqrt(i/(n(r).count-1)))}else n(r).std=0;return r}},remove:function(e,n){return function(r,t,u){if(e&&e(r,t,u),n(r).count>0){n(r).std=0;var i=n(r).sumOfSq-n(r).sum*n(r).sum/n(r).count;i>0&&(n(r).std=Math.sqrt(i/(n(r).count-1)))}else n(r).std=0;return r}},initial:function(e,n){return function(r){return r=e(r),n(r).std=0,r}}},$n={add:function(e,n,r){var t,u;return function(i,o,a){return n&&n(i,o,a),t=r(i).nest,e.forEach(function(e){(u=t.filter(function(n){return n.key===e(o)})[0])?t=u.values:(u=[],t.push({key:e(o),values:u}),t=u)}),t.push(o),i}},remove:function(e,n,r){var t;return function(u,i,o){return n&&n(u,i,o),t=r(u).nest,e.forEach(function(e){t=t.filter(function(n){return n.key===e(i)})[0].values}),t.splice(t.indexOf(i),1),u}},initial:function(e,n){return function(r){return r=e(r),n(r).nest=[],r}}},Rn={initial:function(e,n,r){return function(t){function u(e){return function(){return r[e](n(t))}}for(var i in e&&(t=e(t)),r)n(t)[i]=u(i);return t}}},qn={add:function(e,n,r){return function(t,u,i){for(var o in n&&n(t,u,i),e)r(t)[o]=e[o](r(t),u);return t}}},In={add:function(e,n,r){return function(e,t,u){return n&&n(e,t,u),r(e).dataList.push(t),e}},remove:function(e,n,r){return function(e,t,u){return n&&n(e,t,u),r(e).dataList.splice(r(e).dataList.indexOf(t),1),e}},initial:function(e,n){return function(r){return e&&(r=e(r)),n(r).dataList=[],r}}},Cn={add:function(e,n,r){return function(n,t,u){return e&&e(n,t,u),r(n,t)}},remove:function(e,n,r){return function(n,t,u){return e&&e(n,t,u),r(n,t)}},initial:function(e,n,r){return function(n){return e&&(n=e(n)),r(n)}}};var Fn={build:function e(n,r,t){t||(t=function(e){return e});var u={reduceAdd:r.reduceAdd,reduceRemove:r.reduceRemove,reduceInitial:r.reduceInitial};(n.count||n.std)&&(r.reduceAdd=yn.add(r.reduceAdd,t,n.count),r.reduceRemove=yn.remove(r.reduceRemove,t,n.count),r.reduceInitial=yn.initial(r.reduceInitial,t,n.count)),n.sum&&(r.reduceAdd=bn.add(n.sum,r.reduceAdd,t),r.reduceRemove=bn.remove(n.sum,r.reduceRemove,t),r.reduceInitial=bn.initial(r.reduceInitial,t)),n.avg&&(n.count&&n.sum?(r.reduceAdd=xn.add(n.sum,r.reduceAdd,t),r.reduceRemove=xn.remove(n.sum,r.reduceRemove,t),r.reduceInitial=xn.initial(r.reduceInitial,t)):console.error("You must set .count(true) and define a .sum(accessor) to use .avg(true).")),n.exceptionCount&&(n.exceptionAccessor?(r.reduceAdd=_n.add(n.exceptionAccessor,r.reduceAdd,t),r.reduceRemove=_n.remove(n.exceptionAccessor,r.reduceRemove,t),r.reduceInitial=_n.initial(r.reduceInitial,t)):console.error("You must define an .exception(accessor) to use .exceptionCount(true).")),n.exceptionSum&&(n.exceptionAccessor?(r.reduceAdd=Sn.add(n.exceptionAccessor,n.exceptionSum,r.reduceAdd,t),r.reduceRemove=Sn.remove(n.exceptionAccessor,n.exceptionSum,r.reduceRemove,t),r.reduceInitial=Sn.initial(r.reduceInitial,t)):console.error("You must define an .exception(accessor) to use .exceptionSum(accessor).")),(n.valueList||n.median||n.min||n.max)&&(r.reduceAdd=Ln.add(n.valueList,r.reduceAdd,t),r.reduceRemove=Ln.remove(n.valueList,r.reduceRemove,t),r.reduceInitial=Ln.initial(r.reduceInitial,t)),n.dataList&&(r.reduceAdd=In.add(n.dataList,r.reduceAdd,t),r.reduceRemove=In.remove(n.dataList,r.reduceRemove,t),r.reduceInitial=In.initial(r.reduceInitial,t)),n.median&&(r.reduceAdd=An.add(r.reduceAdd,t),r.reduceRemove=An.remove(r.reduceRemove,t),r.reduceInitial=An.initial(r.reduceInitial,t)),n.min&&(r.reduceAdd=kn.add(r.reduceAdd,t),r.reduceRemove=kn.remove(r.reduceRemove,t),r.reduceInitial=kn.initial(r.reduceInitial,t)),n.max&&(r.reduceAdd=On.add(r.reduceAdd,t),r.reduceRemove=On.remove(r.reduceRemove,t),r.reduceInitial=On.initial(r.reduceInitial,t)),n.exceptionAccessor&&(r.reduceAdd=wn.add(n.exceptionAccessor,r.reduceAdd,t),r.reduceRemove=wn.remove(n.exceptionAccessor,r.reduceRemove,t),r.reduceInitial=wn.initial(r.reduceInitial,t)),n.histogramValue&&n.histogramThresholds&&(r.reduceAdd=Pn.add(n.histogramValue,r.reduceAdd,t),r.reduceRemove=Pn.remove(n.histogramValue,r.reduceRemove,t),r.reduceInitial=Pn.initial(n.histogramThresholds,r.reduceInitial,t)),n.sumOfSquares&&(r.reduceAdd=jn.add(n.sumOfSquares,r.reduceAdd,t),r.reduceRemove=jn.remove(n.sumOfSquares,r.reduceRemove,t),r.reduceInitial=jn.initial(r.reduceInitial,t)),n.std&&(n.sumOfSquares&&n.sum?(r.reduceAdd=En.add(r.reduceAdd,t),r.reduceRemove=En.remove(r.reduceRemove,t),r.reduceInitial=En.initial(r.reduceInitial,t)):console.error("You must set .sumOfSq(accessor) and define a .sum(accessor) to use .std(true). Or use .std(accessor).")),n.custom&&(r.reduceAdd=Cn.add(r.reduceAdd,t,n.custom.add),r.reduceRemove=Cn.remove(r.reduceRemove,t,n.custom.remove),r.reduceInitial=Cn.initial(r.reduceInitial,t,n.custom.initial)),n.nestKeys&&(r.reduceAdd=$n.add(n.nestKeys,r.reduceAdd,t),r.reduceRemove=$n.remove(n.nestKeys,r.reduceRemove,t),r.reduceInitial=$n.initial(r.reduceInitial,t)),n.aliasKeys&&(r.reduceInitial=Rn.initial(r.reduceInitial,t,n.aliasKeys)),n.aliasPropKeys&&(r.reduceAdd=qn.add(n.aliasPropKeys,r.reduceAdd,t),r.reduceRemove=qn.add(n.aliasPropKeys,r.reduceRemove,t)),n.filter&&(r.reduceAdd=gn.add(n.filter,r.reduceAdd,u.reduceAdd,t),r.reduceRemove=gn.remove(n.filter,r.reduceRemove,u.reduceRemove,t)),n.values&&Object.getOwnPropertyNames(n.values).forEach(function(u){var i;r.reduceInitial=(i=r.reduceInitial,function(e){return e=i(e),t(e)[u]={},e}),e(n.values[u].parameters,r,function(e){return e[u]})})}},zn=function(){return{order:!1,avg:!1,count:!1,sum:!1,exceptionAccessor:!1,exceptionCount:!1,exceptionSum:!1,filter:!1,valueList:!1,median:!1,histogramValue:!1,min:!1,max:!1,histogramThresholds:!1,std:!1,sumOfSquares:!1,values:!1,nestKeys:!1,aliasKeys:!1,aliasPropKeys:!1,groupAll:!1,dataList:!1,custom:!1}};var Nn={build:function e(n,r){function t(e){if("string"==typeof e){var n=e;return function(e){return e[n]}}return e}function u(e){if("string"==typeof e){var n=e;return function(e){return+e[n]}}return e}n.fromObject=function(e){return arguments.length?(function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),r=1;r<arguments.length;++r){var t=arguments[r];if(null!=t)for(var u in t)t.hasOwnProperty(u)&&(n[u]=t[u])}}(r,e),n):r},n.toObject=function(){return r},n.count=function(e,t){return arguments.length?(t||(t="count"),r.count=t,n):r.count},n.sum=function(e){return arguments.length?(e=u(e),r.sum=e,n):r.sum},n.avg=function(e){return arguments.length?("function"==typeof(e=u(e))?(r.sum&&r.sum!==e&&console.warn("SUM aggregation is being overwritten by AVG aggregation"),r.sum=e,r.avg=!0,r.count="count"):r.avg=e,n):r.avg},n.exception=function(e){return arguments.length?(e=t(e),r.exceptionAccessor=e,n):r.exceptionAccessor},n.filter=function(e){return arguments.length?(r.filter=e,n):r.filter},n.valueList=function(e){return arguments.length?(e=t(e),r.valueList=e,n):r.valueList},n.median=function(e){return arguments.length?("function"==typeof(e=u(e))&&(r.valueList&&r.valueList!==e&&console.warn("VALUELIST accessor is being overwritten by median aggregation"),r.valueList=e),r.median=e,n):r.median},n.min=function(e){return arguments.length?("function"==typeof(e=u(e))&&(r.valueList&&r.valueList!==e&&console.warn("VALUELIST accessor is being overwritten by min aggregation"),r.valueList=e),r.min=e,n):r.min},n.max=function(e){return arguments.length?("function"==typeof(e=u(e))&&(r.valueList&&r.valueList!==e&&console.warn("VALUELIST accessor is being overwritten by max aggregation"),r.valueList=e),r.max=e,n):r.max},n.exceptionCount=function(e){return arguments.length?("function"==typeof(e=t(e))?(r.exceptionAccessor&&r.exceptionAccessor!==e&&console.warn("EXCEPTION accessor is being overwritten by exception count aggregation"),r.exceptionAccessor=e,r.exceptionCount=!0):r.exceptionCount=e,n):r.exceptionCount},n.exceptionSum=function(e){return arguments.length?(e=u(e),r.exceptionSum=e,n):r.exceptionSum},n.histogramValue=function(e){return arguments.length?(e=u(e),r.histogramValue=e,n):r.histogramValue},n.histogramBins=function(e){return arguments.length?(r.histogramThresholds=e,n):r.histogramThresholds},n.std=function(e){return arguments.length?("function"==typeof(e=u(e))?(r.sumOfSquares=e,r.sum=e,r.count="count",r.std=!0):r.std=e,n):r.std},n.sumOfSq=function(e){return arguments.length?(e=u(e),r.sumOfSquares=e,n):r.sumOfSquares},n.value=function(n,t){if(arguments.length&&"string"==typeof n)return r.values||(r.values={}),r.values[n]={},r.values[n].parameters=zn(),e(r.values[n],r.values[n].parameters),t&&(r.values[n].accessor=t),r.values[n];console.error("'value' requires a string argument.")},n.nest=function(e){return arguments.length?(e.map(t),r.nestKeys=e,n):r.nestKeys},n.alias=function(e){return arguments.length?(r.aliasKeys=e,n):r.aliasKeys},n.aliasProp=function(e){return arguments.length?(r.aliasPropKeys=e,n):r.aliasPropKeys},n.groupAll=function(e){return arguments.length?(r.groupAll=e,n):r.groupAll},n.dataList=function(e){return arguments.length?(r.dataList=e,n):r.dataList},n.custom=function(e){return arguments.length?(r.custom=e,n):r.custom}}};var Bn=function(e){return function(n,r,t){n.post=function(){var u=function(){return u.all()};u.all=function(){return n.all()};var i=e.postprocessors;return Object.keys(i).forEach(function(e){u[e]=function(){var n=u.all,o=[].slice.call(arguments);return u.all=function(){return i[e](n,t,r).apply(null,o)},u}}),u}}},Mn=function(e){return function(n){return n[e]}};const Un=function(e,n){return e||(e=function(e){return e}),function(r,t){n&&n(r,t);var u=e(r),i=e(t);return void 0!==i.count&&(u.count+=i.count),void 0!==i.sum&&(u.sum+=i.sum),void 0!==i.avg&&(u.avg=u.sum/u.count),r}};var Kn=function(e,n,r){n.reduceInitial();var t=r.values?Object.keys(r.values):[],u=Un();if(t.length)for(var i=0;i<t.length;++i)u=Un(Mn(t[i]),u);return function(r,t){if(!arguments.length)return e();if(r===1/0||!r)return e();var i=e(),o=r-1;if(i.length<=r)return i;var a=i.slice(0,o),c={key:t||"Others"};c.value=n.reduceInitial();for(var s=o;s<i.length;++s)u(c.value,i[s].value);return a.push(c),a}};function Dn(e,n){return e<n?-1:e>n?1:e>=n?0:NaN}var Tn=function(e){return function(n,r){return 1===arguments.length&&(r=Dn),e().sort((t=function(e){if("function"==typeof e)return e;if(~e.indexOf(".")){var n=e.split(".");return function(e){return n.reduce(function(e,n){return e[n]},e)}}return function(n){return n[e]}}(n),u=r,function(e,n){return u(t(e),t(n))}));var t,u}},Jn=Bn;function Vn(){var e=zn(),n={};function r(r){if(n={reduceAdd:function(e){return e},reduceRemove:function(e){return e},reduceInitial:function(){return{}}},Fn.build(e,n),e.groupAll)if(r.top)console.warn("'groupAll' is defined but attempting to run on a standard dimension.group(). Must run on dimension.groupAll().");else{var t,u,i,o,a,c=un.bisect.by(function(e){return e.key}).left;r.reduce(function(r,s,f){for(i=e.groupAll(s),o=i.length,u=0;u<o;u++)a=i[u],r[t=c(r,a,0,r.length)]&&r[t].key===a||r.splice(t,0,{key:a,value:n.reduceInitial()}),n.reduceAdd(r[t].value,s,f);return r},function(r,a,s){for(i=e.groupAll(a),o=i.length,u=0;u<o;u++)t=c(r,i[u],0,r.length),n.reduceRemove(r[t].value,a,s);return r},function(){return[]}),r.all||(r.all=function(){return this.value()})}else r.reduce(n.reduceAdd,n.reduceRemove,n.reduceInitial);return Jn(r,e,n),r}return Nn.build(r,e),r}!function(e){e.postprocessors={},e.registerPostProcessor=function(n,r){e.postprocessors[n]=r},e.registerPostProcessor("cap",Kn),e.registerPostProcessor("sortBy",Tn)}(Vn),Jn=Jn(Vn);var Yn=Vn,Gn={shorthandLabels:{$count:"count",$sum:"sum",$avg:"avg",$min:"min",$max:"max",$med:"med",$sumSq:"sumSq",$std:"std"},aggregators:{$count:function(e){return e.count(!0)},$sum:function(e,n){return e.sum(n)},$avg:function(e,n){return e.avg(n)},$min:function(e,n){return e.min(n)},$max:function(e,n){return e.max(n)},$med:function(e,n){return e.median(n)},$sumSq:function(e,n){return e.sumOfSq(n)},$std:function(e,n){return e.std(n)},$valueList:function(e,n){return e.valueList(n)},$dataList:function(e){return e.dataList(!0)}}};function Wn(n){return n.locked?e.clone(n.data):n.data}var Qn=function(n){var r=function(n){var r=pn(n);return function(n){var t=Yn();if(function n(r,t){var u=e.sortBy(e.map(t,function(e,n){return{key:n,value:e}}),function(e){return Gn.aggregators[e.key]?0:1});return e.forEach(u,function(t){if(Gn.aggregators[t.key]){var u=sn.makeValueAccessor(t.value);r=Gn.aggregators[t.key](r,u)}else e.isObject(t.value)?n(r.value(t.key),t.value):console.error("Nested selects must be an object",t.key)})}(t,n.select),n.filter){var u=r.makeFunction(n.filter);u&&t.filter(u)}return Promise.resolve(t)}}(n),t=pn(n),u=function(){return{post:function(e,n,r){return e.data=Wn(n),Promise.resolve(r(e,n))},sortByKey:function(n,r,t){n.data=Wn(r),n.data=e.sortBy(n.data,function(e){return e.key}),t&&n.data.reverse()},limit:function(n,r,t,u){n.data=Wn(r),e.isUndefined(u)?(u=t||0,t=0):(t=t||0,u=u||n.data.length),n.data=n.data.splice(t,u-t)},squash:function(n,r,t,u,i,o){n.data=Wn(r),t=t||0,u=u||n.data.length;var a=n.data.splice(t,u-t),c={key:o||"Other",value:{}};e.recurseObject(i,function(n,r,t){var u=[];e.forEach(a,function(n){u.push(e.get(n.value,t))}),e.set(c.value,t,sn.aggregators[n](u))}),n.data.splice(t,0,c)},change:function(n,r,t,u,i){n.data=Wn(r),t=t||0,u=u||n.data.length;var o={key:[n.data[t].key,n.data[u].key],value:{}};e.recurseObject(i,function(r,i,a){var c=e.clone(a);c.pop(),c.push(i+"Change"),e.set(o.value,c,e.get(n.data[u].value,a)-e.get(n.data[t].value,a))}),n.data=o},changeMap:function(n,r,t,u){u=e.isUndefined(u)?0:u,n.data=Wn(r),e.recurseObject(t,function(r,t,i){var o=e.clone(i),a=e.clone(i),c=e.clone(i);o.pop(),a.pop(),c.pop(),o.push(t+"Change"),a.push(t+"ChangeFromStart"),c.push(t+"ChangeFromEnd");var s=e.get(n.data[0].value,i,u),f=e.get(n.data[n.data.length-1].value,i,u);e.forEach(n.data,function(r,t){var l=n.data[t-1]||n.data[0];e.set(n.data[t].value,o,e.get(r.value,i,u)-(l?e.get(l.value,i,u):u)),e.set(n.data[t].value,a,e.get(r.value,i,u)-s),e.set(n.data[t].value,c,e.get(r.value,i,u)-f)})})}}}(),i=e.keys(u);return function(o){for(var a=JSON.stringify(o),c=0;c<n.columns.length;c++)for(var s=0;s<n.columns[c].queries.length;s++)if(n.columns[c].queries[s].hash===a)return new Promise(function(e,r){try{e(n.columns[c].queries[s])}catch(e){r(e)}});var f={original:o,hash:a};return e.isUndefined(f.original)&&(f.original={}),e.isUndefined(f.original.select)&&(f.original.select={$count:!0}),f.original.groupBy=f.original.groupBy||!0,function(r){return n.column({key:r.original.groupBy,type:e.isUndefined(r.type)?null:r.type,array:Boolean(r.array)}).then(function(){var e=n.column.find(r.original.groupBy);return r.column=e,e.queries.push(r),e.removeListeners.push(function(){return r.clear()}),r})}(f=function(r,t){var o=!1;t||(t=r,r={},o=!0);e.assign(r,{universe:n,crossfilter:n.cf,parent:t,column:t.column,dimension:t.dimension,group:t.group,reducer:t.reducer,original:t.original,hash:t.hash,removeListeners:[],postAggregations:[],locked:o,lock:function(n){if(!e.isUndefined(n))return void(r.locked=Boolean(n));r.locked=!0},unlock:function(){r.locked=!1},clear:function(){return e.forEach(r.removeListeners,function(e){e()}),new Promise(function(e,n){try{e(r.group.dispose())}catch(e){n(e)}}).then(function(){if(r.column.queries.splice(r.column.queries.indexOf(r),1),!r.column.queries.length)return n.clear(r.column.key)}).then(function(){return n})}});e.forEach(i,function(e){var n;r[e]=(n=u[e],function(){var e=Array.prototype.slice.call(arguments),t={};return p(t,r),e.unshift(t,r),r.postAggregations.push(function(){Promise.resolve(n.apply(null,e)).then(u)}),Promise.resolve(n.apply(null,e)).then(u);function u(){return h(t).then(function(){return t})}})});return r}(f)).then(function(e){return Promise.resolve(e.column.dimension.group()).then(function(n){return e.group=n,e})}).then(function(r){var u=t.scanForDynamicFilters(r.original);if(u.length)return Promise.all(e.map(u,function(e){return n.column({key:e,dynamicReference:r.group})})).then(function(){return r});return r}).then(function(e){var r=n.onDataChange(function(){return l(e)});e.removeListeners.push(r);var t=n.onFilter(function(){return h(e)});return e.removeListeners.push(t),e}).then(l);function l(e){return function(e){return r(e.original).then(function(n){return e.reducer=n,e})}(e).then(d).then(v).then(h)}function d(e){return Promise.resolve(e.reducer(e.group)).then(function(){return e})}function v(e){return Promise.resolve(e.group.all()).then(function(n){return e.data=n,e})}function h(n){return n.postAggregations.length>1&&(n.locked=!0),Promise.all(e.map(n.postAggregations,function(e){return e()})).then(function(){return n})}function p(r,t){var o=false;if(!t){t=r;r={};o=true}e.assign(r,{universe:n,crossfilter:n.cf,parent:t,column:t.column,dimension:t.dimension,group:t.group,reducer:t.reducer,original:t.original,hash:t.hash,removeListeners:[],postAggregations:[],locked:o,lock:a,unlock:c,clear:s});e.forEach(i,function(e){r[e]=f(u[e])});return r;function a(n){if(!e.isUndefined(n)){r.locked=Boolean(n);return}r.locked=true}function c(){r.locked=false}function s(){return e.forEach(r.removeListeners,function(e){e()}),new Promise(function(e,n){try{e(r.group.dispose())}catch(e){n(e)}}).then(function(){if(r.column.queries.splice(r.column.queries.indexOf(r),1),!r.column.queries.length)return n.clear(r.column.key)}).then(function(){return n})}function f(e){return function(){var n=Array.prototype.slice.call(arguments);var t={};p(t,r);n.unshift(t,r);r.postAggregations.push(function(){Promise.resolve(e.apply(null,n)).then(u)});return Promise.resolve(e.apply(null,n)).then(u);function u(){return h(t).then(function(){return t})}}}}}},Xn=function(n){return function(r){return r&&(r=e.isArray(r)?r:[r]),r?Promise.all(e.map(r,function(r){e.isObject(r)&&(r=r.key);var u=e.remove(n.columns,function(n){return e.isArray(r)?!e.xor(n.key,r).length:n.key===r?!n.dynamicReference:void 0})[0];u&&t(u)})).then(function(){return n}):Promise.all(e.map(n.columns,t)).then(function(){return n.columns=[],n});function t(r){var t=[];r.removeListeners&&(t=e.map(r.removeListeners,function(e){return Promise.resolve(e())}));var u=r.key;return"array"===r.complex&&(u=JSON.stringify(r.key)),"function"===r.complex&&(u=r.key.toString()),delete n.filters[u],r.dimension&&t.push(Promise.resolve(r.dimension.dispose())),Promise.all(t)}}},Zn=function(e){return function(){return e.clear().then(function(){return e.cf.dataListeners=[],e.cf.filterListeners=[],Promise.resolve(e.cf.remove())}).then(function(){return e})}};return function(n,r){var t={options:e.assign({},r),columns:[],filters:{},dataListeners:[],filterListeners:[]},u=on(t),i=pn(t);return n=u.generateColumns(n),u.build(n).then(function(n){return t.cf=n,e.assign(t,{add:u.add,remove:u.remove,column:mn(t),query:Qn(t),filter:i.filter,filterAll:i.filterAll,applyFilters:i.applyFilters,clear:Xn(t),destroy:Zn(t),onDataChange:o,onFilter:a})});function o(e){return t.dataListeners.push(e),function(){t.dataListeners.splice(t.dataListeners.indexOf(e),1)}}function a(e){return t.filterListeners.push(e),function(){t.filterListeners.splice(t.filterListeners.indexOf(e),1)}}}});
